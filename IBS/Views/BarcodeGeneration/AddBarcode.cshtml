@model IBS.Models.BarcodeGenerate

@{
    ViewData["Title"] = "Barcode Generate Form";
    string clsView = "";
    // if (Model.LabId > 0)
    // {
    //     clsView = "Permission_View";
    // }
}
<style>
    
    #popup {
        position: fixed;
        top: 0;
        left: 10%;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #popup2 {
        position: fixed;
        top: 0;
        left: 10%;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .popup-content {
        background-color: white;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        width:70%;
    }

    .close-button {
        position: absolute;
        right: 13%;
        background: none;
        border: none;
        cursor: pointer;
        font-size: xx-large;
        margin-top: -2%;
    }
</style>
<div class="list-inner">
    <div class="tast-list">
        <h2>Barcode Generate Form</h2>
    </div>
    <div>
        <a asp-action="Index" asp-controller="BarcodeGeneration" class="formBtn viewall-btn">View List</a>
    </div>
</div>
<section class="@clsView">
    <div class="task-listinput">
        <form data-ajax="true" asp-antiforgery="true" asp-controller="BarcodeGeneration" asp-action="Save" data-ajax-method="post" data-ajax-complete="completed" id="frmbarcode">
        <div class="accordion-body">
            <div class="row my-0">
                <input type="hidden" class="input" asp-for="CALL_RECV_DT">
                <input type="hidden" class="input" asp-for="CALL_SNO">
                <input type="hidden" class="input" asp-for="ITEM_SRNO_PO">
                    <input type="hidden" class="input" asp-for="VEND_CD">
                    <input type="hidden" class="input" asp-for="IE_CD">
                <div class="col-md-3 mb-3">
                    <label for="Reference">Case No</label>
                    <input type="text" class="input" asp-for="CASE_NO">
                    
                </div>
                
                <div class="col-md-3 mb-3 savenext-btn" style="margin-top:auto;">
                    <button type="button" class="save-btn active" onclick="Show();">Search</button>
                </div>
                <div class="col-md-2 mb-3">
                    <label for="Reference">Total Rate</label>
                    <input type="text" class="input" asp-for="TotalRate">
                        <span class="text-danger field-validation-error" id="spnError1"></span>
                </div>
                <div class="col-md-2 mb-3">
                    <label for="Reference">GST Amount</label>
                    <input type="text" class="input" asp-for="GSTAmount">
                        <span class="text-danger field-validation-error" id="spnError2"></span>
                </div>
                <div class="col-md-2 mb-3 savenext-btn" style="margin-top:auto;">
                    <button type="button" class="save-btn active" onclick="LabCalculation()">@Model.Region</button>
                </div>
            </div>
           
            <div class="row my-0">
                <div class="col-md-4 mb-3">
                    <label for="Reference">Customer Name</label>
                    <textarea class="input" asp-for="CUSTOMER_NAME" readonly="readonly"> </textarea>
                    @* <input type="text" class="input" asp-for="CUSTOMER_NAME" readonly="readonly"> *@
                </div>
                <div class="col-md-4 mb-3">
                    <label for="Reference">Sealing Type</label>
                    <input type="text" class="input" asp-for="SEALING_TYPE">
                </div>
                <div class="col-md-4 mb-3">
                    <label for="Reference">Customer GSTN</label>
                    <input type="text" class="input" asp-for="CUSTOMER_GSTN">
                </div>
            </div>
            <div class="row my-0">
                <div class="col-md-4 mb-3">
                    <label for="Reference">Description</label>
                    <textarea class="input" asp-for="DESCRIPTION"> </textarea>
                </div>
                <div class="col-md-4 mb-3">
                    <label for="Reference">Targeted Date</label>
                    <input type="text" class="input datepicker" asp-for="TARGETED_DATE">
                </div>
                <div class="col-md-4 mb-3">
                    <label for="Reference">Current Date</label>
                    <input type="text" class="input" asp-for="CURRENT_DATE" readonly="readonly">
                </div>
            </div>
            <div class="row my-0">
                <div class="col-md-4 mb-3">
                    <label for="Reference">Inspector/Customer</label>
                    <input type="text" class="input" asp-for="INSPECTOR_CUSTOMER" readonly="readonly">
                </div>
            </div>
            <div class="savenext-btn" style="margin-left:47%;">
                <button type="button" class="save-btn active Permission_Save" onclick="SaveBarcode();">Save</button>
            </div>
        </div>
        </form>
    </div>
</section>
<div id="popup" style="display: none;">

        <section class="table-section" style="width:75%;height:78%;margin-top:auto;">
        <span class="close-button" id="close" onclick="ClosePopup();">&times;</span>
            <div class="task-listinput">
                <div class="dash-table">
                    <table id="dtshow" class="table-responsive">
                        <thead>
                            <tr>
                                <th>Vendor Code</th>
                                <th>Case No</th>
                                <th>Call Recv Date</th>
                                <th>Call Sno</th>
                                <th>Item SRNO PO</th>
                                <th>Item Desc PO</th>
                                
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    
</div>
<div id="popup2" style="display: none;">
    <div class="col-lg-12" id="divGrid" style="width:74%;">
       
    </div>
</div>

@section scripts{

    <partial name="_DataTablesScriptsPartial" />
    <partial name="_ValidationScriptsPartial" />

    <script type="text/javascript">

        $(function () {
            
        });
        function Change() {
            
            if ($("#ddlTGST").val() == "IN-STATE") {
                $("#SGST").val("9");
                $("#CGST").val("9");
                $("#IGST").val("18");
            }
            else if ($("#ddlTGST").val() == "OUT-STATE") {
                $("#SGST").val("9");
                $("#CGST").val("9");
                $("#IGST").val("18");
            }
            else
            {
                $("#SGST").val("");
                $("#CGST").val("");
                $("#IGST").val("");
            }
        }
        function InitializeDatatableShow() {
            var CaseNo = $("#CASE_NO").val();
            $("#dtshow").DataTable({
                stateSave: false,// Design Assets
                autoWidth: true,
                scrollX: true,
                scrollCollapse: true,
                processing: true, // ServerSide Setups
                serverSide: true,
                destroy: true,
                paging: true,// Paging Setups
                searching: true,// Searching Setups
                ajax: {// Ajax Filter
                    url: "@Url.Action("CaseNoSearch")",
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: function (d) {
                        var AdditionalValues = {
                            CaseNo: CaseNo
                        };
                        d.AdditionalValues = AdditionalValues;
                        return JSON.stringify(d);
                    }
                },

                columns: [// Columns Setups

                    { data: "CUSTOMER_NAME" },
                    // { data: "CASE_NO" },
                    {
                        data: null, orderable: false,
                        render: function (data, type, row) {

                            var escapedRow = JSON.stringify(row).replace(/"/g, '&quot;');
                            var linkText = row["CASE_NO"];
                            var editLink = '<a href="javascript:void(0);" ' +
                                'onclick="editRow(' + escapedRow + ')" ' +
                                'style="color: blue; text-decoration: underline;">' +
                                linkText +
                                '</a>';

                            return editLink;
                        }
                    },
                    { data: "CALL_RECV_DT" },
                    { data: "CALL_SNO" },
                    { data: "ITEM_SRNO_PO" },
                    { data: "DESCRIPTION" }

                ],

                "order": [[0, "asc"]]
            });

        }

        function editRow(escapedRow) {

            $("#DESCRIPTION").val(escapedRow.DESCRIPTION);
            $("#CUSTOMER_NAME").val(escapedRow.CUSTOMER_NAME);
            $("#CALL_RECV_DT").val(escapedRow.CALL_RECV_DT);
            $("#CALL_SNO").val(escapedRow.CALL_SNO);
            $("#ITEM_SRNO_PO").val(escapedRow.ITEM_SRNO_PO);
            $("#IE_CD").val(escapedRow.IE_CD);
            $("#INSPECTOR_CUSTOMER").val(escapedRow.IE_NAME);
            $("#VEND_CD").val(escapedRow.VEND_CD);
            $("#CUSTOMER_GSTN").val(escapedRow.CUSTOMER_GSTN);
            $("#popup").fadeOut();
        }
        // $("#popup").click(function (event) {
        //     if (!$(event.target).closest(".popup-content").length) {
        //         $("#popup").fadeOut();
        //     }
        // });
        function ClosePopup() {
            $("#popup").fadeOut();
            $("#popup2").fadeOut();
        }
        function Show() {
            InitializeDatatableShow();
            $("#popup").fadeIn();
        }
        function SaveBarcode(){
            $("#spnError1").html("");
            $("#spnError2").html("");
            var IsValid = true;
            if ($("#TotalRate").val() == "") {
                $("#spnError1").html("Please Enter Total Rate");
                IsValid = false;
            }
            if ($("#GSTAmount").val() == "") {
                $("#spnError2").html("Please Enter GST Amount");
                IsValid = false;
            }
            if (!IsValid) return;
            $("#frmbarcode").submit();

        }
        completed = function (response) {
            var res = response.responseJSON;
            ShowHideMsgNew(res.status, res.responseText);
            //window.location.href = "/LaboratoryMaster/LaboratoryMaster";
            window.location.href = '@Url.Action("Index", "BarcodeGeneration")';
        };
        function LabCalculation(){
            $("#popup2").fadeIn();
            $("#divGrid").load('/BarcodeGeneration/LabCalculation');
        }
    </script>
}
