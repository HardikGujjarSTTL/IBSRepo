
--Scaffold-DbContext "Data Source=(DESCRIPTION=(ADDRESS_LIST= (ADDRESS=(COMMUNITY=tcpcom.world)(PROTOCOL=tcp)(HOST=192.168.0.215)(PORT=1521)))(CONNECT_DATA=(SID=orcl))); User ID=IBSDev;Password=IBSDev" Oracle.EntityFrameworkCore -OutputDir DataAccess -Force

--=============================================================================================================================================
--By Neha Gehlot
--=============================================================================================================================================
create or replace PROCEDURE GetConsigneeDetails (
    p_case_no IN VARCHAR2,
    p_bk_no IN VARCHAR2,
    p_set_no IN VARCHAR2,
    p_result_cursor OUT SYS_REFCURSOR
)
IS
BEGIN
    OPEN p_result_cursor FOR
  SELECT 
           TRIM(t13.PO_NO) || '   dated- ' || TO_CHAR(t13.PO_DT, 'dd/mm/yyyy') AS PO,
           t13.RLY_CD,
           t20.CONSIGNEE_CD,
           TO_CHAR(t20.IC_DT, 'dd/mm/yyyy') AS IC_DT,
           v06.CONSIGNEE,
           t13.VEND_CD,
           v05.VENDOR,
           t20.case_no,
           t20.bk_no,
           t20.set_no,
           t20.ic_no,
           t09.ie_name,
           v05.vendor,
           t13.region_code,
           t08.co_name
    FROM T13_PO_MASTER t13
    --JOIN t40_consignee_complaints t40 ON t09.IE_CD = t40.ie_cd
    JOIN T20_IC t20 ON t13.CASE_NO = t20.CASE_NO
    JOin T09_IE t09 ON t20.ie_cd = t09.ie_cd
    JOIN V06_CONSIGNEE v06 ON t20.CONSIGNEE_CD = v06.CONSIGNEE_CD
    JOIN V05_VENDOR v05 ON t13.VEND_CD = v05.VEND_CD
    JOIN T08_IE_CONTROLL_OFFICER t08 ON t20.co_cd = t08.co_cd
    WHERE t20.CASE_NO = p_case_no
      AND t20.BK_NO = p_bk_no
      AND t20.SET_NO = p_set_no;

    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        RAISE;
END;
/

CREATE OR REPLACE PROCEDURE "GETFILTEREDCONSIGNEECOMPLAINTS" (
    p_po_no_param IN VARCHAR2,
     p_po_date_param IN VARCHAR2,
    p_result_cursor OUT SYS_REFCURSOR
)
IS
BEGIN
    OPEN p_result_cursor FOR
    SELECT CASE_NO, PO_NO, PO_DT, RLY_CD, VEND_NAME, CONSIGNEE, BK_NO, SET_NO, IC_NO, IC_DATE
    FROM (
        SELECT m.CASE_NO, m.PO_NO, m.PO_DT, (DECODE(m.RLY_NONRLY, 'R', 'Railway', 'P', 'Private', 'S', 'State Government', 'F', 'Foreign Railways', 'U', 'PSU') || '(' || m.RLY_CD || ')') RLY_CD,
               (v.VEND_NAME || '(' || NVL2(t.LOCATION, t.LOCATION || ' : ' || t.CITY, t.CITY) || ')') VEND_NAME, c.CONSIGNEE, i.BK_NO, i.SET_NO, i.IC_NO, i.IC_DT IC_DATE
        FROM T13_PO_MASTER m, T05_VENDOR v, V06_CONSIGNEE c, T03_CITY t, T20_IC i
        WHERE m.VEND_CD = v.VEND_CD AND v.VEND_CITY_CD = t.CITY_CD
        AND i.CONSIGNEE_CD = c.CONSIGNEE_CD(+) AND m.CASE_NO = i.CASE_NO
        AND (p_po_no_param IS NULL OR UPPER(TRIM(PO_NO)) LIKE '%' || UPPER(TRIM(p_po_no_param)) || '%')
        AND (p_po_date_param IS NULL OR TO_DATE(TO_CHAR(PO_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') = p_po_date_param)
        --AND (p_po_date_param IS NULL OR m.PO_DT = TO_DATE(p_po_date_param, 'dd-MM-yy'))
        -- Adjust the date comparison
        MINUS
        SELECT m.CASE_NO, m.PO_NO, m.PO_DT, (DECODE(m.RLY_NONRLY, 'R', 'Railway', 'P', 'Private', 'S', 'State Government', 'F', 'Foreign Railways', 'U', 'PSU') || '(' || m.RLY_CD || ')') RLY_CD,
               (v.VEND_NAME || '(' || NVL2(t.LOCATION, t.LOCATION || ' : ' || t.CITY, t.CITY) || ')') VEND_NAME, c.CONSIGNEE, i.BK_NO, i.SET_NO, i.IC_NO, i.IC_DT AS IC_DATE
        FROM T13_PO_MASTER m, T05_VENDOR v, V06_CONSIGNEE c, T03_CITY t, T20_IC i, T40_CONSIGNEE_COMPLAINTS comp
        WHERE m.VEND_CD = v.VEND_CD AND v.VEND_CITY_CD = t.CITY_CD
        AND i.CONSIGNEE_CD = c.CONSIGNEE_CD(+) AND m.CASE_NO = i.CASE_NO
        AND i.CASE_NO = comp.CASE_NO AND i.BK_NO = comp.BK_NO AND i.SET_NO = comp.SET_NO
        AND (p_po_no_param IS NULL OR UPPER(TRIM(PO_NO)) LIKE '%' || UPPER(TRIM(p_po_no_param)) || '%')
        AND (p_po_date_param IS NULL OR m.PO_DT = TO_DATE(p_po_date_param, 'dd-MM-yy'))
         --AND (p_po_date_param IS NULL OR TO_DATE(TO_CHAR(PO_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') = p_po_date_param)
         
    )
   
  ORDER BY CASE_NO, BK_NO, SET_NO,IC_DATE;
   
    
END;
/

CREATE OR REPLACE PROCEDURE "GETFILTERNCR" (
    lst_ie          IN VARCHAR2,
    frm_dt          IN VARCHAR2 DEFAULT NULL,
    to_dt           IN VARCHAR2 DEFAULT NULL,
    p_result_cursor OUT SYS_REFCURSOR
) IS
BEGIN
    OPEN p_result_cursor FOR SELECT
                                                          t41.nc_no                               nc_no,
                                                          t20.case_no                             case_no,
                                                          t20.bk_no                               bk_no,
                                                          t20.set_no                              set_no,
                                                          to_char(t17.call_recv_dt, 'dd/mm/yyyy') call_recv_date,
                                                          t17.call_sno                            call_sno,
                                                          t09.ie_sname                            ie_sname,
                                                          ( t06.consignee_cd
                                                            || '-'
                                                            || nvl2(TRIM(t06.consignee_desig),
                                                                    TRIM(t06.consignee_desig)
                                                                    || '/',
                                                                    '')
                                                            || nvl2(TRIM(t06.consignee_dept),
                                                                    TRIM(t06.consignee_dept)
                                                                    || '/',
                                                                    '')
                                                            || nvl2(TRIM(t06.consignee_firm),
                                                                    TRIM(t06.consignee_firm)
                                                                    || '/',
                                                                    '')
                                                            || nvl2(TRIM(t06.consignee_add1),
                                                                    TRIM(t06.consignee_add1)
                                                                    || '/',
                                                                    '')
                                                            || nvl2(TRIM(t03.location),
                                                                    TRIM(t03.location)
                                                                    || ' : '
                                                                    || TRIM(t03.city),
                                                                    TRIM(t03.city)) )                       consignee
                                                      FROM
                                                          t17_call_register t17,
                                                          t20_ic            t20,
                                                          t09_ie            t09,
                                                          t06_consignee     t06,
                                                          t03_city          t03,
                                                          t41_nc_master     t41
                             WHERE
                                     t20.case_no = t17.case_no
                                 AND t20.call_recv_dt = t17.call_recv_dt
                                 AND t20.call_sno = t17.call_sno
                                 AND t17.ie_cd = t09.ie_cd
                                 AND t20.consignee_cd = t06.consignee_cd
                                 AND t06.consignee_city = t03.city_cd
                                 AND t20.bk_no = t41.bk_no (+)
                                 AND t20.set_no = t41.set_no (+)
                                 AND t20.case_no = t41.case_no (+)
                                 AND t17.region_code = 'N'
                                 AND upper(t17.ie_cd) = lst_ie
                                 AND ( t17.call_recv_dt BETWEEN TO_DATE(frm_dt, 'dd/mm/yyyy') AND TO_DATE(to_dt, 'dd/mm/yyyy') )
                             ORDER BY
                                 call_recv_date,
                                 case_no;

END getfilterncr;
/


create or replace PROCEDURE GetForAction_M_NCR (
    p_nc_no IN VARCHAR2,
    p_result_cursor OUT SYS_REFCURSOR
)
IS
BEGIN
    OPEN p_result_cursor FOR
    SELECT
        T41.NC_NO,
        TO_CHAR(T41.NC_DT, 'dd/mm/yyyy') AS NC_DATE,
        T41.CONSIGNEE_CD,
        (TRIM(T06.CONSIGNEE_DESIG) || '/' || TRIM(T06.CONSIGNEE_DEPT) || '/' || TRIM(T06.CONSIGNEE_FIRM) || '/' || T031.CITY) AS CONSIGNEE,
        T05.VEND_NAME || ',' || T03.CITY AS VENDOR,
        T41.VEND_CD,
        T41.PO_NO,
        TO_CHAR(T41.PO_DT, 'dd/mm/yyyy') AS PO_DT,
        T41.BK_NO,
        T41.SET_NO,
        T41.CASE_NO,
        TO_CHAR(T41.CALL_RECV_DT, 'dd/mm/yyyy') AS CALL_RECV_DT,
        T41.CALL_SNO,
        T41.IE_CD,
        T41.IC_NO,
        TO_CHAR(T41.IC_DT, 'dd/mm/yyyy') AS IC_DATE,
        T09.IE_NAME,
        T41.ITEM_DESC_PO,
        T41.ITEM_SRNO_PO,
        T09.user_id,
        T41.QTY_PASSED,
        t41.region_code
    FROM
        T41_NC_MASTER T41
        JOIN T05_VENDOR T05 ON T41.VEND_CD = T05.VEND_CD
        JOIN T03_CITY T03 ON T05.VEND_CITY_CD = T03.CITY_CD
        JOIN T06_CONSIGNEE T06 ON T41.CONSIGNEE_CD = T06.CONSIGNEE_CD
        JOIN T03_CITY T031 ON T06.CONSIGNEE_CITY = T031.CITY_CD
        JOIN T09_IE T09 ON T41.IE_CD = T09.IE_CD
    WHERE
        T41.NC_NO = p_nc_no;

    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        RAISE;
END GetForAction_M_NCR;
/

create or replace PROCEDURE GetForAction_A_NCR (
    p_case_no IN VARCHAR2,
    p_bk_no IN VARCHAR2,
    p_set_no IN VARCHAR2,
    p_result_cursor OUT SYS_REFCURSOR
)
IS
BEGIN
    OPEN p_result_cursor FOR
    SELECT
        T06.CONSIGNEE_CD,
        (TRIM(T06.CONSIGNEE_DESIG) || '/' || TRIM(T06.CONSIGNEE_DEPT) || '/' || TRIM(T06.CONSIGNEE_FIRM) || '/' || T031.CITY) AS CONSIGNEE,
        T05.VEND_NAME || ',' || T03.CITY AS VENDOR,
        T13.VEND_CD,
        T13.PO_NO,
        TO_CHAR(T13.PO_DT, 'dd/mm/yyyy') AS PO_DT,
        T20.BK_NO,
        T20.SET_NO,
        T20.CASE_NO,
        TO_CHAR(T20.CALL_RECV_DT, 'dd/mm/yyyy') AS CALL_RECV_DT,
        T20.CALL_SNO,
        T20.IE_CD,
        T20.IC_NO,
        TO_CHAR(T20.IC_DT, 'dd/mm/yyyy') AS IC_DATE,
        T09.IE_NAME,
        T09.user_id,
        t17.region_code
    FROM
        T13_PO_MASTER T13
        JOIN T17_CALL_REGISTER T17 ON T13.CASE_NO = T17.CASE_NO
        JOIN T20_IC T20 ON T20.CASE_NO = T17.CASE_NO AND T20.CALL_RECV_DT = T17.CALL_RECV_DT AND T20.CALL_SNO = T17.CALL_SNO
        JOIN T05_VENDOR T05 ON T13.VEND_CD = T05.VEND_CD
        JOIN T03_CITY T03 ON T05.VEND_CITY_CD = T03.CITY_CD
        JOIN T06_CONSIGNEE T06 ON T20.CONSIGNEE_CD = T06.CONSIGNEE_CD
        JOIN T03_CITY T031 ON T06.CONSIGNEE_CITY = T031.CITY_CD
        JOIN T09_IE T09 ON T20.IE_CD = T09.IE_CD
    WHERE
        T20.CASE_NO = p_case_no
        AND T20.BK_NO = p_bk_no
        AND T20.SET_NO = p_set_no;

    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        RAISE;
END GetForAction_A_NCR;
/

create or replace PROCEDURE GET_NCR_Email
(
    p_NC_NO IN VARCHAR2,
    p_cursor OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN p_cursor FOR
    SELECT
        T41.IC_NO,
        TO_CHAR(T41.IC_DT, 'dd/mm/yyyy') AS IC_DATE,
        T41.NC_NO,
        TO_CHAR(NC_DT, 'dd/mm/yyyy') AS NC_DT,
        T41.CASE_NO,
        T41.BK_NO,
        T41.SET_NO,
        T41.PO_NO,
        TO_CHAR(T41.PO_DT, 'dd/mm/yyyy') AS PO_DATE,
        T41.ITEM_SRNO_PO,
        T41.ITEM_DESC_PO,
        T41.IE_CD,
        T41.USER_ID,
        T42.NC_CD,
        T42.IE_ACTION1,
        CO_FINAL_REMARKS1,
        NVL2(
            T42.NC_DESC_OTHERS,
            T69.NC_DESC || '-' || T42.NC_DESC_OTHERS,
            T69.NC_DESC
        ) AS NC_DESC,
        T69.NC_CLASS,
        T09.IE_NAME,
        T08.CO_NAME,
        T09.IE_EMAIL || ';' || T08.CO_EMAIL AS EMAIL
    FROM
        T41_NC_MASTER T41,
        T42_NC_DETAIL T42,
        T69_NC_CODES T69,
        T09_IE T09,
        T08_IE_CONTROLL_OFFICER T08
    WHERE
        T41.NC_NO = T42.NC_NO
        AND T42.NC_CD = T69.NC_CD
        AND T41.IE_CD = T09.IE_CD
        AND T41.CO_CD = T08.CO_CD
        AND T41.NC_NO = p_NC_NO;
END GET_NCR_Email;
/

create or replace PROCEDURE GENERATE_NC_NO_New(
    IN_REGION_CD IN VARCHAR2,
    IN_NC_DT IN VARCHAR2,
    p_result_cursor OUT SYS_REFCURSOR
) AS
    w_ctr VARCHAR2(100) := NULL;
    w_sno CHAR(100) := NULL;
    W_ERR_CD NUMBER := -1;
    w_NC_NO VARCHAR2(500) := NULL;
    my_exception EXCEPTION;

BEGIN
    w_ctr := IN_REGION_CD || SUBSTR(IN_NC_DT, 9, 2);

    -- Get the next sequence number for the given region and NC_DT


    SELECT lpad(nvl(max(to_number(nvl(substr(NC_NO,5,8),0))),0)+1,4,'0')
    INTO w_sno
    FROM T41_NC_MASTER
    WHERE SUBSTR(NC_NO, 1, 3) = w_ctr;
    w_NC_NO := TRIM(w_NC_NO);
    -- Construct the generated case number
    w_NC_NO := w_ctr || '-' || w_sno;
   
    IF LENGTH(w_NC_NO) <> 8 THEN
        W_ERR_CD := -2;
        
    END IF;

    -- Open the ref cursor and fetch the result set
    OPEN p_result_cursor FOR
    SELECT w_NC_NO AS w_NC_NO, W_ERR_CD AS W_ERR_CD FROM DUAL;


END;
/

ALTER TABLE T41_NC_MASTER 
    MODIFY ITEM_SRNO_PO  NUMBER(6,0);
    
ALTER TABLE T41_NC_MASTER 
    MODIFY IE_CD  NUMBER(6,0);
    
ALTER TABLE T41_NC_MASTER 
    MODIFY CO_CD  NUMBER(6,0);

 ALTER TABLE TEMP_ONLINE_COMPLAINTS ADD (
  CONSTRAINT TEMP_ONLINE_COMPLAINTS_pk PRIMARY KEY (TEMP_COMPLAINT_ID));

  INSERT INTO menu_master (ID, parentid, controllername, actionname, title, menudescription, role_id, iconcssclass, isactive, sortorder, iconpath)
VALUES (163, 98, 'ComplaintApproval', 'Index', 'Online Complaint Approval', '', '', '', 1, 12, '');

ALTER TABLE temp_online_complaints 
    MODIFY IE_CD  NUMBER(6,0);
    
ALTER TABLE temp_online_complaints 
    MODIFY CO_CD  NUMBER(6,0);

    ALTER TABLE T40_Consignee_Complaints 
    MODIFY IE_CD  NUMBER(6,0);
    
    ALTER TABLE T40_Consignee_Complaints 
    MODIFY IE_CO_CD  NUMBER(6,0);
    
    ALTER TABLE T40_Consignee_Complaints 
    MODIFY UOM_CD  NUMBER(6,0);
    
    ALTER TABLE T40_Consignee_Complaints 
    MODIFY JI_IE_CD  NUMBER(6,0);

    ALTER TABLE t32_client_login
    ADD ID NUMBER(6,0);

    ALTER TABLE T100_CONTRACT
ADD LETTER_NO NVARCHAR2(50);

    MERGE INTO T32_CLIENT_LOGIN t
    USING (
      SELECT ROW_NUMBER() OVER (ORDER BY user_name) AS RowNo, mobile
      FROM T32_CLIENT_LOGIN
    ) subquery
    ON (t.mobile = subquery.mobile)
    WHEN MATCHED THEN
      UPDATE SET t.id = subquery.RowNo;

      ALTER TABLE T100_Contract
ADD IsDeleted INT;

ALTER TABLE T100_Contract
ADD CreatedBy INT;

ALTER TABLE T100_Contract
ADD UpdatedBy INT;

ALTER TABLE T100_Contract
ADD CreatedDate DATE;

ALTER TABLE T100_Contract
ADD updatedDate DATE;



create or replace PROCEDURE GENERATE_TEMP_COMPLAINT_NO(
    IN_TEMP_COMPLAINT_DT IN char,
    p_result_cursor OUT SYS_REFCURSOR
) IS
	w_ctr char(2) :=null;
	w_sno char(5) :=null;
     W_ERR_CD NUMBER := -1;
    w_compid varchar2(500) :=null;
	my_exception exception;
BEGIN
	W_ERR_CD := -1;
	---
	if to_number(substr(IN_TEMP_COMPLAINT_DT,4,2)) > 3 then
	   w_ctr := lpad(substr(IN_TEMP_COMPLAINT_DT,9,2),2,'0');
	else
	   w_ctr := lpad(substr(IN_TEMP_COMPLAINT_DT,9,2)-1,2,'0');
	end if;
	Select lpad(nvl(max(to_number(nvl(trim(substr(TEMP_COMPLAINT_ID,4,5)),'0'))),0)+1,5,'0') into w_sno
	From TEMP_ONLINE_COMPLAINTS where substr(TEMP_COMPLAINT_ID,1,2)=w_ctr;
	---
	w_compid:=trim(w_ctr||'-'||w_sno);
	if length(w_compid) <> 8 then
	   W_ERR_CD := -2;
	end if;
	---
	OPEN p_result_cursor FOR
 SELECT w_compid AS w_compid, W_ERR_CD AS W_ERR_CD FROM DUAL;
END;
/

CREATE OR REPLACE PROCEDURE "GET_REJECTIONCOMPLAINT_DETAILS" 
(
    p_CaseNo IN VARCHAR2,
    p_BkNo IN VARCHAR2,
    p_SetNo IN VARCHAR2,
    p_TempComplaintId IN VARCHAR2,
    p_ResultCursor OUT SYS_REFCURSOR
)
IS
BEGIN
    OPEN p_ResultCursor FOR
        SELECT
            P.CASE_NO,
            P.PO_NO,
            p.region_code,
            TO_CHAR(P.PO_DT, 'dd/mm/yyyy') AS PO_DT,
            V.VENDOR,
            T20.BK_NO,
            T09.IE_NAME,
            T20.SET_NO,
            T20.IC_NO,
            TO_CHAR(T20.IC_DT, 'dd/mm/yyyy') AS IC_DATE,
            V06.CONSIGNEE,
            T.TEMP_COMPLAINT_ID,
            TO_CHAR(T.TEMP_COMPLAINT_DT, 'dd/mm/yyyy') AS TEMP_COMPLAINT_DATE,
            T.ITEM_DESC,
            T.QTY_OFFERED,
            T.QTY_REJECTED,
            T.REJECTION_VALUE,
            T.REJECTION_REASON,
            T.TEMP_COMPLAINT_ID,
            t.rej_memo_dt,
            t.rej_memo_no
        FROM
            V05_VENDOR V,
            T13_PO_MASTER P,
            T20_IC T20,
            TEMP_ONLINE_COMPLAINTS T,
            V06_CONSIGNEE V06,
            T09_IE T09
        WHERE
            T.CASE_NO = P.CASE_NO
            AND P.VEND_CD = V.VEND_CD
            AND T20.CONSIGNEE_CD = V06.CONSIGNEE_CD
            AND T.BK_NO = T20.BK_NO
            AND T.SET_NO = T20.SET_NO
            AND T.CASE_NO = T20.CASE_NO
            AND T20.IE_CD = T09.IE_CD
            AND T.CASE_NO = p_CaseNo
            AND T.BK_NO = p_BkNo
            AND T.SET_NO = p_SetNo
            AND T.TEMP_COMPLAINT_ID = p_TempComplaintId;

    -- You can return the result cursor to the calling code
END GET_REJECTIONCOMPLAINT_DETAILS;
/


create or replace PROCEDURE GENERATE_JI_SNO(
   IN_INSP_REGION IN varchar2,
   IN_JI_REGION IN varchar2,
   IN_COMPLAINT_DT IN varchar2,
   p_result_cursor OUT SYS_REFCURSOR
) IS
	w_ctr char(9) :=null;
	w_sno char(4) :=null;
        W_ERR_CD NUMBER := -1;
        w_jisno varchar2(13) :=null;
	my_exception exception;
BEGIN
	W_ERR_CD := -1;
	---
	if to_number(substr(IN_COMPLAINT_DT,4,2)) > 3 then
	   w_ctr := IN_INSP_REGION||IN_JI_REGION||'/'||lpad(substr(IN_COMPLAINT_DT,9,2),2,'0')||'-'||lpad(substr(IN_COMPLAINT_DT,9,2)+1,2,'0')||'/';
	else
	   w_ctr := IN_INSP_REGION||IN_JI_REGION||'/'||lpad(substr(IN_COMPLAINT_DT,9,2)-1,2,'0')||'-'||lpad(substr(IN_COMPLAINT_DT,9,2),2,'0')||'/';
	end if;
	Select lpad(nvl(max(to_number(nvl(trim(substr(JI_SNO,10,4)),'0'))),0)+1,4,'0') into w_sno
	From T40_CONSIGNEE_COMPLAINTS where substr(JI_SNO,1,9)=w_ctr;
	---
	w_jisno := trim(w_ctr||w_sno);
	if length(w_jisno) <> 13 then
	    W_ERR_CD := -2;
	    raise my_exception;
	end if;
	---
	OPEN p_result_cursor FOR
 SELECT w_jisno AS w_jisno, W_ERR_CD AS W_ERR_CD FROM DUAL;
END;
/

create or replace PROCEDURE GENERATE_COMPLAINT_NO(
      IN_REGION_CD IN varchar2,
      IN_COMPLAINT_DT IN varchar2,
     p_result_cursor OUT SYS_REFCURSOR
) IS
	w_ctr char(8) :=null;
	w_sno char(4) :=null;
	w_compid varchar2(12) :=null;   
	OUT_ERR_CD NUMBER := -1;
	my_exception exception;
BEGIN
	OUT_ERR_CD := -1;
	---
	if to_number(substr(IN_COMPLAINT_DT,4,2)) > 3 then
	   w_ctr := IN_REGION_CD||'/'||lpad(substr(IN_COMPLAINT_DT,9,2),2,'0')||'-'||lpad(substr(IN_COMPLAINT_DT,9,2)+1,2,'0')||'/';
	else
	   w_ctr :=   IN_REGION_CD||'/'||lpad(substr(IN_COMPLAINT_DT,9,2)-1,2,'0')||'-'||lpad(substr(IN_COMPLAINT_DT,9,2),2,'0')||'/';
	end if;
	Select lpad(nvl(max(to_number(nvl(trim(substr(COMPLAINT_ID,9,4)),'0'))),0)+1,4,'0') into w_sno
	From T40_CONSIGNEE_COMPLAINTS where substr(COMPLAINT_ID,1,8)=w_ctr;
   	---
	w_compid:=trim(w_ctr||w_sno);
	if length(w_compid) <> 12 then
	    OUT_ERR_CD := -2;
	    raise my_exception;
	end if;
	---
	OPEN p_result_cursor FOR
 SELECT w_compid AS w_compid, OUT_ERR_CD AS OUT_ERR_CD FROM DUAL;

END;
/

create or replace PROCEDURE GetConsigneeComplaint (
    p_PONo       VARCHAR2,
    p_PODate     VARCHAR2,
    p_ResultSet  OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN p_ResultSet FOR
    SELECT
        c.COMPLAINT_ID,
        c.JI_SNO,
        c.CASE_NO,
        c.BK_NO,
        c.SET_NO,
        m.PO_NO,
        m.PO_DT,
        c.IC_NO,
        c.IC_DT,
        c.REJ_MEMO_NO,
        c.REJ_MEMO_DT
    FROM T13_PO_MASTER m
    JOIN V40_CONSIGNEE_COMPLAINTS c ON m.CASE_NO = c.CASE_NO
    WHERE
        UPPER(TRIM(m.PO_NO)) LIKE UPPER(TRIM('%' || p_PONo || '%'))
        AND TO_CHAR(m.PO_DT, 'dd-mm-yyyy') = p_PODate
    ORDER BY c.CASE_NO, c.COMPLAINT_ID ASC;
END GetConsigneeComplaint;
/

CREATE OR REPLACE PROCEDURE "GETCONSIGNEECOMPLAINTDETAILS" (
    p_complaint_id IN VARCHAR2,
    p_result OUT SYS_REFCURSOR
) AS
BEGIN
    OPEN p_result FOR
         SELECT
      to_char(c.COMPLAINT_DT, 'dd/mm/yyyy') AS COMPLAINT_DATE,c.REJ_MEMO_NO,c.REJ_MEMO_DT,c.CASE_NO,c.BK_NO,c.SET_NO,trim(m.PO_NO) || ' dated - ' || to_char(m.PO_DT, 'dd/mm/yyyy') AS PO,
      m.RLY_CD,to_char(d.IC_DT, 'dd/mm/yyyy') AS IC_DT,m.region_code,c.IE_CO_CD,c.COMP_RECV_REGION,f.VEND_NAME,f.vend_cd,c.ITEM_SRNO_PO,c.ITEM_DESC,c.QTY_OFFERED,c.QTY_REJECTED,m.USER_ID,
      c.RATE,c.REJECTION_VALUE,c.ROOT_CAUSE_ANALYSIS,c.TECH_REF,c.CHKSHEET_STATUS,c.ANY_OTHER,c.CAPA_STATUS,c.DANDAR_STATUS,c.REJECTION_REASON,c.STATUS,c.JI_REQUIRED,um.uom_s_desc,um.uom_cd,
      c.JI_REGION,c.NO_JI_REASON,c.JI_IE_CD,c.IE_CD,c.CONSIGNEE_CD,c.REMARKS,c.JI_SNO, to_char(c.JI_FIX_DT, 'dd/mm/yyyy') AS JI_FIX_DT,to_char(c.JI_DT, 'dd/mm/yyyy') AS JI_DT,e.consignee,
      c.DEFECT_CD,c.JI_STATUS_CD,to_char(c.CONCLUSION_DT, 'dd/mm/yyyy') AS CONCLUSION_DT,c.ACTION_PROPOSED,to_char(c.ACTION_PROPOSED_DT, 'dd/mm/yyyy') AS ACTION_PROPOSED_DT,
      c.PENALTY_TYPE,to_char(c.PENALTY_DT, 'dd/mm/yyyy') AS PENALTY_DT,c.ACTION
    FROM T13_PO_MASTER m
    JOIN T20_IC d ON m.CASE_NO = d.CASE_NO
    JOIN T40_CONSIGNEE_COMPLAINTS c ON d.CASE_NO = c.CASE_NO
   left JOIN T04_UOM um ON c.uom_cd = um.uom_cd
    JOIN V06_CONSIGNEE e ON c.CONSIGNEE_CD = e.CONSIGNEE_CD  
    JOIN T05_VENDOR f ON c.VEND_CD = f.VEND_CD  
        WHERE
            c.COMPLAINT_ID = p_complaint_id;
END GetConsigneeComplaintDetails;
/

create or replace PROCEDURE CMWiseICDetail(
   p_region VARCHAR2,
   p_start_date VARCHAR2,
   p_end_date VARCHAR2,
   p_result OUT SYS_REFCURSOR
)
AS
BEGIN
 OPEN p_result FOR
      SELECT TO_CHAR(T17.CALL_STATUS_DT, 'dd/mm/yyyy') AS IC_ISSUED_DT,
                     T17.CASE_NO,
                      T17.BK_NO,
                      T17.SET_NO,
                      T09.IE_NAME,
                      T08.CO_NAME
                 FROM T17_CALL_REGISTER T17
                      LEFT JOIN T30_IC_RECEIVED T30 ON (T17.BK_NO = T30.BK_NO AND T17.SET_NO = T30.SET_NO AND T17.REGION_CODE = T30.REGION),
                      T09_IE T09,
                      T08_IE_CONTROLL_OFFICER T08
                WHERE (T30.BK_NO IS NULL AND T30.SET_NO IS NULL AND T30.REGION IS NULL)
                  AND T17.IE_CD = T09.IE_CD
                  AND T09.IE_CO_CD = T08.CO_CD
                  AND T17.CALL_STATUS IN ('A', 'R')
                 AND SUBSTR(T17.CASE_NO, 1, 1) = SUBSTR(p_region, 1, 1)
                  AND (T17.CALL_STATUS_DT BETWEEN TO_DATE(p_start_date, 'dd/mm/yyyy') AND TO_DATE(p_end_date, 'dd/mm/yyyy'));
                 
END;
/

ALTER TABLE t32_client_login ADD ISDELETED NUMBER(2,0);

CREATE OR REPLACE PROCEDURE "GETCLIENTINFO" (
    p_clientname IN VARCHAR2,
     p_ResultSet  OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN p_ResultSet FOR
        select 
        ID as ClientId,USER_NAME,ORGANISATION,DESIGNATION,MOBILE,EMAIL,UNIT,ORGN_TYPE
        from t32_client_login
        WHERE  isdeleted = 0 OR isdeleted IS NULL
          AND UPPER(TRIM(USER_NAME)) LIKE UPPER(TRIM(p_clientname)) || '%';
END GetClientInfo;
/


CREATE TABLE T100_Contract (
    ID NUMBER(6) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    Letter_No NUMBER(6),
    Letter_date DATE,
    TPFrom DATE,
    TPTO DATE,
    ClientType NVARCHAR2(50),
    ClientName VARCHAR2(50),
    Inspfee NUMBER,
    MandayBasis NUMBER,
    LotOfInsp NUMBER,
    MaterialValue NUMBER,
    MinPOVal NUMBER,
    MaxPOVal NUMBER,
    CallCancelation NUMBER,
    MaterialDescription NVARCHAR2(250)
);

CREATE TABLE Non_Rly_Client (
    ID NUMBER(6) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    ClientName VARCHAR2(50),
    ShortCode VARCHAR2(50),
    ContactName VARCHAR2(50),
    ContactDesignation VARCHAR2(50),
    MobileNo NUMBER,
    EmailID VARCHAR2(50),
    Updateate DATE,
    Createdate DATE,
    UpdatedBy NUMBER(6,0),
    CreatedBy NUMBER(6,0),
    IsDeleted NUMBER(6,0),
    ORGANIZATIONTYPEID NUMBER(6,0)
);

CREATE TABLE Organization_Type(
    OrganizationTypeID  NUMBER(6) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    OrganizationType VARCHAR2(50)
);


CREATE TABLE FeedbackSuggestion (
    ID NUMBER(6) GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    Email NVARCHAR2(50),
    Region VARCHAR2(50),
    Name VARCHAR2(50),
    MobileNo VARCHAR2(50),
    Subject VARCHAR2(50),
    Description NVARCHAR2(250)
);

create or replace PROCEDURE GetContractInfo(
    p_clientname IN VARCHAR2,
    p_clienttype IN VARCHAR2,
    p_ResultSet OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN p_ResultSet FOR
    SELECT 
        ID,
        LETTER_NO,
        TO_CHAR(LETTER_DATE, 'dd/mm/yyyy') AS LETTER_DATE,
        TO_CHAR(TPFROM, 'dd/mm/yyyy') AS TPFROM,
        TO_CHAR(TPTO,'dd/mm/yyyy') AS TPTO,
        CLIENTTYPE,
        CLIENTNAME,
        INSPFEE,
        MANDAYBASIS,
        LOTOFINSP,
        MATERIALVALUE,
        MINPOVAL,
        MAXPOVAL,
        CALLCANCELATION,
        MATERIALDESCRIPTION
    FROM T100_CONTRACT
    WHERE (p_clientname IS NULL OR CLIENTNAME = p_clientname)
    AND (p_clienttype IS NULL OR CLIENTTYPE = p_clienttype)
    AND isdeleted = 0 OR isdeleted IS NULL;
END GetContractInfo;
/


create or replace PROCEDURE GetSearchAllData (
    p_case_no      IN VARCHAR2,
    p_region      IN VARCHAR2,
    p_po_no        IN VARCHAR2,
    p_po_dt        IN VARCHAR2,
    p_consignee_cd IN VARCHAR2,
    p_bpo_cd       IN VARCHAR2,
    p_vend_cd      IN VARCHAR2,
    p_call_dt      DATE,
    p_call_sno     IN VARCHAR2,
    p_ie_cd        IN VARCHAR2,
    p_bk_no        IN VARCHAR2,
    p_set_no       IN VARCHAR2,
    p_bill_no      IN VARCHAR2,
    p_bill_dt      DATE,
    p_bill_amt     IN NUMBER,
    p_ResultSet OUT SYS_REFCURSOR
) 
AS
BEGIN
    OPEN p_ResultSet FOR

   SELECT
        T13.CASE_NO,
        T13.PO_NO,
        TO_CHAR(T13.PO_DT, 'dd/mm/yyyy') AS PO_DT,
        T14.CONSIGNEE_CD,
        T14.BPO_CD,
        TO_CHAR(T17.CALL_RECV_DT, 'dd/mm/yyyy') AS CALL_RECV_DT,
        T17.CALL_SNO,
        T17.IE_CD,
        T20.BK_NO,
        T20.SET_NO,
        T22.BILL_NO,
        TO_CHAR(T22.BILL_DT, 'dd/mm/yyyy') AS BILL_DT,
        T09.IE_SNAME,
        T09.IE_CD,
        V06.CONSIGNEE_CD || '-' || V06.CONSIGNEE AS CONSIGNEE,
        T22.INSP_FEE,
        T22.BILL_AMOUNT
    FROM
        T13_PO_MASTER T13
        JOIN T14_PO_BPO T14 ON T13.CASE_NO = T14.CASE_NO
        JOIN T17_CALL_REGISTER T17 ON T13.CASE_NO = T17.CASE_NO
        JOIN T20_IC T20 ON T17.CASE_NO = T20.CASE_NO
        JOIN T22_BILL T22 ON T20.BILL_NO = T22.BILL_NO
        JOIN T09_IE T09 ON T20.IE_CD = T09.IE_CD
        JOIN V06_CONSIGNEE V06 ON T20.CONSIGNEE_CD = V06.CONSIGNEE_CD
        where T13.CASE_NO=T14.CASE_NO and T13.CASE_NO=T17.CASE_NO and T17.CASE_NO = T20.CASE_NO and T17.CALL_RECV_DT=T20.CALL_RECV_DT and T17.CALL_SNO=T20.CALL_SNO and T14.CONSIGNEE_CD = T20.CONSIGNEE_CD and T20.BILL_NO=T22.BILL_NO and T20.IE_CD=T09.IE_CD and T20.CONSIGNEE_CD=V06.CONSIGNEE_CD 
        And T13.REGION_CODE = p_region
        And (p_case_no IS NULL OR T13.CASE_NO = p_case_no)
        AND (p_po_no IS NULL OR UPPER(T13.PO_NO) LIKE UPPER('%' || p_po_no || '%'))
        AND (p_po_dt IS NULL OR TO_CHAR(T13.PO_DT, 'dd/mm/yyyy') = p_po_dt)
        AND (p_consignee_cd IS NULL OR T14.CONSIGNEE_CD = p_consignee_cd)
        AND (p_bpo_cd IS NULL OR T14.BPO_CD = p_bpo_cd)
        AND (p_vend_cd IS NULL OR T13.VEND_CD = p_vend_cd)
        AND (p_call_dt IS NULL OR T17.CALL_RECV_DT = p_call_dt)
        AND (p_call_sno IS NULL OR T17.CALL_SNO = p_call_sno)
        AND (p_ie_cd IS NULL OR T17.IE_CD = p_ie_cd)
        AND (p_bk_no IS NULL OR T20.BK_NO = p_bk_no)
        AND (p_set_no IS NULL OR T20.SET_NO = p_set_no)
        AND (p_bill_no IS NULL OR T22.BILL_NO = p_bill_no)
        AND (p_bill_dt IS NULL OR T22.BILL_DT = p_bill_dt)
        AND (p_bill_amt IS NULL OR T22.BILL_AMOUNT = p_bill_amt)
    ORDER BY
        T13.CASE_NO,
        T17.CALL_RECV_DT;
END GetSearchAllData;
/

create or replace PROCEDURE GetComplaintDetailsReport (
    p_JI_SNO IN VARCHAR2,
    p_cursor OUT SYS_REFCURSOR
)
IS
BEGIN
    OPEN p_cursor FOR
    SELECT
        JI_SNO,
        TO_CHAR(COMPLAINT_DT, 'dd/mm/yyyy') AS COMPLAINT_DATE,
        V40.CONSIGNEE_NAME || ',' || CONSIGNEE_ADDR AS CONSIGNEE,
        PO_NO || ' Dated: ' || TO_CHAR(PO_DT, 'dd/mm/yyyy') AS PO,
        IE_NAME,
        INSP_REGION_NAME,
        IC_NO || ' Dated: ' || TO_CHAR(IC_DT, 'dd/mm/yyyy') AS IC,
        BK_NO,
        SET_NO,
        VENDOR,
        ITEM_DESC,
        QTY_OFFERED,
        QTY_REJECTED,
        REJECTION_VALUE,
        REJECTION_REASON,
        IE_JI_REMARKS,
        TO_CHAR(JI_DT, 'dd/mm/yyyy') AS JI_DATE,
        ACTION,
        T39.JI_STATUS_DESC AS JI_STATUS,
        T08.CO_NAME
    FROM
        V40_CONSIGNEE_COMPLAINTS V40
    LEFT JOIN
        T39_JI_STATUS_CODES T39
    ON
        V40.JI_STATUS_CD = T39.JI_STATUS_CD
    LEFT JOIN
        T08_IE_CONTROLL_OFFICER T08
    ON
        V40.IE_CO_CD = T08.CO_CD
    WHERE
        V40.JI_SNO = p_JI_SNO;
END GetComplaintDetailsReport;
/

CREATE OR REPLACE PROCEDURE "COMPLIANTS_STATEMENT_ALLIE_DATE" (
    p_frm_dt IN VARCHAR2,
    p_to_dt IN VARCHAR2,
    p_ie_cd IN VARCHAR2,
    p_fin_year IN VARCHAR2,
    p_finyear_value IN VARCHAR2,
    p_region IN VARCHAR2,
    p_result OUT SYS_REFCURSOR
) AS
BEGIN
    IF p_ie_cd IS NOT NULL AND p_frm_dt IS NOT NULL AND p_to_dt IS NOT NULL THEN
        OPEN p_result FOR
        Select  Name,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From 
            ( Select B.IE_NAME as Name ,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, T09_IE B, T22_BILL C  WHERE A.IE_CD=B.IE_CD AND C.BILL_NO=A.BILL_NO and B.IE_CD=p_ie_cd AND (C.BILL_DT BETWEEN to_date(p_frm_dt,'dd/mm/yyyy') AND to_date(p_to_dt,'dd/mm/yyyy')) AND SUBSTR(A.case_no,1,1)='N' GROUP BY IE_NAME  
            union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)='N'  group by T09.IE_NAME
            union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)='N'   group by T09.IE_NAME
            union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)='N'  group by T09.IE_NAME
            union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)='N'  group by T09.IE_NAME
            union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)='N'  group by T09.IE_NAME
            union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)='N'  group by T09.IE_NAME
            union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)='N'  group by T09.IE_NAME
            union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)='N'  group by T09.IE_NAME
            union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)='N'  group by T09.IE_NAME
            union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)='N'  group by T09.IE_NAME
            union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)='N'  group by T09.IE_NAME
            union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)='N'  group by T09.IE_NAME
            ) group by Name order by Name;
    ELSIF p_frm_dt IS NOT NULL AND p_to_dt IS NOT NULL THEN
         OPEN p_result FOR
          Select  Name,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From 
        ( Select B.IE_NAME Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, T09_IE B, T22_BILL C  WHERE A.IE_CD=B.IE_CD AND C.BILL_NO=A.BILL_NO  AND (C.BILL_DT BETWEEN to_date(p_frm_dt,'dd/mm/yyyy') AND to_date(p_to_dt,'dd/mm/yyyy')) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY IE_NAME 
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T09.IE_NAME 
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME 
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (V40.JI_DT between to_date(p_frm_dt,'dd/mm/yyyy') and to_date(p_to_dt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        ) group by Name order by Name;
        
    ELSIF p_fin_year IS NOT NULL THEN
       OPEN p_result FOR
        Select  Name,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From 
        ( Select B.IE_NAME Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, T09_IE B, T22_BILL C  WHERE A.IE_CD=B.IE_CD AND C.BILL_NO=A.BILL_NO  AND (substr(C.BILL_NO,2,2)=p_finyear_value) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY IE_NAME  
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        ) group by Name order by Name;
        
     ELSIF p_ie_cd IS NOT NULL AND p_fin_year IS NOT NULL THEN 
           OPEN p_result FOR
        Select  Name,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From 
        ( Select B.IE_NAME Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, T09_IE B, T22_BILL C  WHERE A.IE_CD=B.IE_CD AND C.BILL_NO=A.BILL_NO and B.IE_CD=p_ie_cd AND (substr(C.BILL_NO,2,2)=p_finyear_value) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY IE_NAME  
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
         union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region   group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        union all Select T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and V40.IE_CD=p_ie_cd and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (substr(V40.JI_SNO,4,5)=p_fin_year) and substr(CASE_NO,1,1)=p_region  group by T09.IE_NAME
        ) group by Name order by Name;
    END IF ;
    
END compliants_statement_AllIE_Date;
/

CREATE OR REPLACE PROCEDURE "COMPLIANTS_STATEMENT_ALLVENDOR_REPORT" (
    p_frmdt IN VARCHAR2,
    p_todt IN VARCHAR2,
    p_vend_cd IN VARCHAR2,
    p_finyear IN VARCHAR2,
    p_finyear_value IN VARCHAR2,
    p_region IN VARCHAR2,
    p_result OUT SYS_REFCURSOR
) AS
BEGIN

    IF p_frmdt IS NOT NULL AND p_todt IS NOT NULL THEN
        OPEN p_result FOR
        Select  Name,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From 
        ( Select B.VENDOR as Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, V05_VENDOR B, T22_BILL C, T13_PO_MASTER D  WHERE A.CASE_NO=D.CASE_NO and D.VEND_CD=B.VEND_CD AND C.BILL_NO=A.BILL_NO  AND (C.BILL_DT BETWEEN to_date(p_frmdt,'dd/mm/yyyy') AND to_date(p_todt,'dd/mm/yyyy')) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY B.VENDOR  
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
         union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V05.VENDOR
        ) group by Name order by Name;

    ELSIF  p_vend_cd IS NOT NULL AND p_frmdt IS NOT NULL AND p_todt IS NOT NULL THEN
    OPEN p_result FOR
        Select  Name,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From 
        ( Select B.VENDOR as Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, V05_VENDOR B, T22_BILL C, T13_PO_MASTER D  WHERE A.CASE_NO=D.CASE_NO and D.VEND_CD=B.VEND_CD AND C.BILL_NO=A.BILL_NO and B.VEND_CD=p_vend_cd AND (C.BILL_DT BETWEEN to_date(p_frmdt,'dd/mm/yyyy') AND to_date(p_todt,'dd/mm/yyyy')) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY B.VENDOR  
         union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
         union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
         union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
         union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
         ) group by Name order by Name;

    ELSIF p_finyear IS NOT NULL THEN
    OPEN p_result FOR
        Select  Name,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From 
        ( Select B.VENDOR as Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, V05_VENDOR B, T22_BILL C, T13_PO_MASTER D  WHERE A.CASE_NO=D.CASE_NO and D.VEND_CD=B.VEND_CD AND C.BILL_NO=A.BILL_NO  AND (substr(C.BILL_NO,2,2)=p_finyear_value) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY B.VENDOR  
        union all Select V05.VENDOR ,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR ,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR ,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
         union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR ,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR ,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
         ) group by Name order by Name;

     ELSIF p_vend_cd IS NOT NULL AND p_finyear IS NOT NULL THEN
     OPEN p_result FOR
        Select  Name,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From 
        ( Select B.VENDOR as Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, V05_VENDOR B, T22_BILL C, T13_PO_MASTER D  WHERE A.CASE_NO=D.CASE_NO and D.VEND_CD=B.VEND_CD AND C.BILL_NO=A.BILL_NO and B.VEND_CD=p_vend_cd  AND (substr(C.BILL_NO,2,2)=p_finyear_value) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY B.VENDOR  
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
         union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
         union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        union all Select V05.VENDOR,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V05_VENDOR  V05 where V40.VEND_CD=V05.VEND_CD and V40.VEND_CD=p_vend_cd and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by V05.VENDOR
        ) group by Name order by Name;
    END IF;


END compliants_statement_AllVendor_Report;
/

CREATE OR REPLACE PROCEDURE "COMPLIANTS_STATEMENT_ALLCM_REPORT" (
    p_frmdt IN VARCHAR2,
    p_todt IN VARCHAR2,
    p_CO IN VARCHAR2,
    p_finyear IN VARCHAR2,
    p_finyear_value IN VARCHAR2,
    p_region IN VARCHAR2,
    p_result OUT SYS_REFCURSOR
) AS
BEGIN
     IF p_frmdt IS NOT NULL AND p_todt IS NOT NULL THEN
     OPEN p_result FOR
             Select  Name,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From 
            ( Select B.CO_NAME Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, T08_IE_CONTROLL_OFFICER B, T22_BILL C  WHERE A.CO_CD=B.CO_CD AND C.BILL_NO=A.BILL_NO  AND (C.BILL_DT BETWEEN to_date(p_frmdt,'dd/mm/yyyy') AND to_date(p_todt,'dd/mm/yyyy')) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY B.CO_NAME 
            union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
            union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
            union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
            union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
            union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
             union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
            union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
            union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
            union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
            union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
            union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
            union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
            ) group by Name order by Name;
     ELSIF p_CO IS NOT NULL AND p_frmdt IS NOT NULL AND p_todt IS NOT NULL THEN
     OPEN p_result FOR
        Select Name,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From 
        ( Select B.CO_NAME Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, T08_IE_CONTROLL_OFFICER B, T22_BILL C  WHERE A.CO_CD=B.CO_CD AND C.BILL_NO=A.BILL_NO and A.CO_CD=p_CO AND (C.BILL_DT BETWEEN to_date(p_frmdt,'dd/mm/yyyy') AND to_date(p_todt,'dd/mm/yyyy')) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY B.CO_NAME 
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
         union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
        ) group by Name order by Name;
     ELSIF p_finyear IS NOT NULL THEN
     OPEN p_result FOR
        Select  Name,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From 
        ( Select B.CO_NAME Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, T08_IE_CONTROLL_OFFICER B, T22_BILL C  WHERE A.CO_CD=B.CO_CD AND C.BILL_NO=A.BILL_NO  AND (substr(C.BILL_NO,2,2)=p_finyear_value) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY B.CO_NAME  
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by T08.CO_NAME
         union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by T08.CO_NAME
         union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by T08.CO_NAME
        ) group by Name order by Name;
     ELSIF p_finyear IS NOT NULL AND p_CO IS NOT NULL THEN
     OPEN p_result FOR
        Select Name,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From 
        ( Select B.CO_NAME Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, T08_IE_CONTROLL_OFFICER B, T22_BILL C  WHERE A.CO_CD=B.CO_CD AND C.BILL_NO=A.BILL_NO and A.CO_CD=p_CO AND (substr(C.BILL_NO,2,2)=p_finyear_value) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY B.CO_NAME  
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by T08.CO_NAME
         union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by T08.CO_NAME
         union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region	 group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region	 group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by T08.CO_NAME
        union all Select T08.CO_NAME CM,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T08_IE_CONTROLL_OFFICER T08 where V40.IE_CO_CD=T08.CO_CD and V40.IE_CO_CD=p_CO and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region  group by T08.CO_NAME
        ) group by Name order by Name;
     END IF;
END compliants_statement_AllCM_Report;
/


CREATE OR REPLACE PROCEDURE "COMPLIANTS_STATEMENT_ALLCLIENT_REPORT" (
    p_frmdt IN VARCHAR2,
    p_todt IN VARCHAR2,
    p_bpo_rly IN VARCHAR2,
    p_finyear IN VARCHAR2,
    p_finyear_value IN VARCHAR2,
    p_region IN VARCHAR2,
    p_result OUT SYS_REFCURSOR
) AS
BEGIN

  IF p_frmdt IS NOT NULL AND p_todt IS NOT NULL THEN
     OPEN p_result FOR
            Select  Name,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From 
            ( Select BPO_RLY Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, T12_BILL_PAYING_OFFICER B, T22_BILL C  WHERE A.BPO_CD=B.BPO_CD AND C.BILL_NO=A.BILL_NO AND (C.BILL_DT BETWEEN to_date(p_frmdt,'dd/mm/yyyy') AND to_date(p_todt,'dd/mm/yyyy')) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY B.BPO_RLY  
            union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by RLY_CD
            union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by RLY_CD
             union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=0 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by RLY_CD
             union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=1 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by RLY_CD
            union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=2 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by RLY_CD
             union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=3 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by RLY_CD
            union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=4 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by RLY_CD
            union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=5 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by RLY_CD
            union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=6 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by RLY_CD
            union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=7 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by RLY_CD
            union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=8 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by RLY_CD
            union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=9 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region  group by RLY_CD
            ) group by Name order by Name;
     ELSIF p_bpo_rly IS NOT NULL AND p_frmdt IS NOT NULL AND p_todt IS NOT NULL THEN
     OPEN p_result FOR
        Select  Name,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From 
        ( Select BPO_RLY Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, T12_BILL_PAYING_OFFICER B, T22_BILL C  WHERE A.BPO_CD=B.BPO_CD AND C.BILL_NO=A.BILL_NO and B.BPO_RLY=p_bpo_rly  AND (C.BILL_DT BETWEEN to_date(p_frmdt,'dd/mm/yyyy') AND to_date(p_todt,'dd/mm/yyyy')) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY B.BPO_RLY  
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by RLY_CD
        ) group by Name order by Name;
     ELSIF p_finyear IS NOT NULL THEN
     OPEN p_result FOR
        Select  Name,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From 
        ( Select BPO_RLY Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, T12_BILL_PAYING_OFFICER B, T22_BILL C  WHERE A.BPO_CD=B.BPO_CD AND C.BILL_NO=A.BILL_NO AND (substr(C.BILL_NO,2,2)=p_finyear_value) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY B.BPO_RLY 
         union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=0 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=1 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10  group by RLY_CD
         union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=2 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=3 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=4 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=5 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=6 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=7 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=8 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
         union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where  JI_REQUIRED='Y' and JI_STATUS_CD=9 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
         ) group by Name order by Name;
     ELSIF p_finyear IS NOT NULL AND p_bpo_rly IS NOT NULL THEN
     OPEN p_result FOR
        Select  Name,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From 
        ( Select BPO_RLY Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, T12_BILL_PAYING_OFFICER B, T22_BILL C  WHERE A.BPO_CD=B.BPO_CD AND C.BILL_NO=A.BILL_NO and B.BPO_RLY=p_bpo_rly  AND (substr(C.BILL_NO,2,2)=p_finyear_value) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY B.BPO_RLY  
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
         union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10  group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
         union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
         union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
        union all Select RLY_CD BPO_RLY,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40 where V40.RLY_CD=p_bpo_rly and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region and V40.JI_STATUS_CD<>10 group by RLY_CD
        ) group by Name order by Name;
     END IF;
END compliants_statement_AllClient_Report;
/

CREATE OR REPLACE PROCEDURE "COMPLIANTS_STATEMENT_ALLCONSIGNEE_REPORT" (
    p_frmdt IN VARCHAR2,
    p_todt IN VARCHAR2,
    p_consignee_cd IN VARCHAR2,
    p_finyear IN VARCHAR2,
    p_finyear_value IN VARCHAR2,
    p_region IN VARCHAR2,
    p_result OUT SYS_REFCURSOR
) AS
BEGIN

  IF p_frmdt IS NOT NULL AND p_todt IS NOT NULL THEN
     OPEN p_result FOR
            Select  Name,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From 
            ( Select B.CONSIGNEE Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, V06_CONSIGNEE B, T22_BILL C  WHERE A.CONSIGNEE_CD=B.CONSIGNEE_CD AND C.BILL_NO=A.BILL_NO  AND (C.BILL_DT BETWEEN to_date(p_frmdt,'dd/mm/yyyy') AND to_date(p_todt,'dd/mm/yyyy')) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY B.CONSIGNEE 
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
             union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
             union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
             union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            ) group by Name order by Name;
     ELSIF p_consignee_cd IS NOT NULL AND p_frmdt IS NOT NULL AND p_todt IS NOT NULL THEN
     OPEN p_result FOR
           Select  Name ,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From 
            ( Select B.CONSIGNEE Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, V06_CONSIGNEE B, T22_BILL C  WHERE A.CONSIGNEE_CD=B.CONSIGNEE_CD AND C.BILL_NO=A.BILL_NO and B.CONSIGNEE_CD=p_consignee_cd  AND (C.BILL_DT BETWEEN to_date(p_frmdt,'dd/mm/yyyy') AND to_date(p_todt,'dd/mm/yyyy')) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY B.CONSIGNEE  
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (V40.JI_DT between to_date(p_frmdt,'dd/mm/yyyy') and to_date(p_todt,'dd/mm/yyyy')) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
            ) group by Name order by Name;
     ELSIF p_finyear IS NOT NULL THEN
     OPEN p_result FOR
        Select  Name,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From
        ( Select B.CONSIGNEE Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, V06_CONSIGNEE B, T22_BILL C  WHERE A.CONSIGNEE_CD=B.CONSIGNEE_CD AND C.BILL_NO=A.BILL_NO  AND (substr(C.BILL_NO,2,2)=p_finyear_value) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY B.CONSIGNEE  
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region   group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region   group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        ) group by Name order by Name ;
     ELSIF p_finyear IS NOT NULL AND p_consignee_cd IS NOT NULL THEN
     OPEN p_result FOR
         Select  Name ,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,sum(MATERIAL_VALUE) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC From
        ( Select B.CONSIGNEE Name,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, V06_CONSIGNEE B, T22_BILL C  WHERE A.CONSIGNEE_CD=B.CONSIGNEE_CD AND C.BILL_NO=A.BILL_NO and B.CONSIGNEE_CD=p_consignee_cd  AND (substr(C.BILL_NO,2,2)=p_finyear_value) AND SUBSTR(A.case_no,1,1)=p_region GROUP BY B.CONSIGNEE 
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        union all Select V06.CONSIGNEE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, V06_CONSIGNEE  V06 where V40.CONSIGNEE_CD=V06.CONSIGNEE_CD and V40.CONSIGNEE_CD=p_consignee_cd and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (substr(V40.JI_SNO,4,5)=p_finyear) and substr(CASE_NO,1,1)=p_region group by V06.CONSIGNEE
        ) group by Name order by Name;
     END IF;
END compliants_statement_AllConsignee_Report;
/

create or replace PROCEDURE GetWriteOffEntryDetails(
    p_frm_dt IN VARCHAR2,
    p_to_dt IN VARCHAR2,
    p_bpo_CD IN VARCHAR2,
    P_RESULT_CURSOR OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN P_RESULT_CURSOR FOR

   SELECT T22.BILL_NO, T22.BILL_DT, T22.BILL_AMOUNT, T22.AMOUNT_RECEIVED, T22.BILL_AMT_CLEARED, T22.WRITE_OFF_AMT, T26.CHQ_DT, T26.BPO_CD
    FROM T26_CHEQUE_POSTING T26
    JOIN T22_BILL T22 ON T26.BILL_NO = T22.BILL_NO
    WHERE NVL(WRITE_OFF_AMT, 0) = 0
        AND (p_bpo_CD IS NULL OR T26.BPO_CD = p_bpo_CD)
        AND (p_frm_dt IS NULL OR T26.CHQ_DT BETWEEN TO_DATE(p_frm_dt, 'dd/mm/yyyy') AND TO_DATE(p_to_dt, 'dd/mm/yyyy'))
        --AND (T22.WRITE_OFF_AMT = 0 OR T22.WRITE_OFF_AMT IS NULL)
        AND T22.AMOUNT_RECEIVED <> T22.BILL_AMOUNT;

END;
/

ALTER TABLE Non_Rly_Client ADD ORGNTYPE  VARCHAR2(20 BYTE);

create or replace PROCEDURE GetNonClientInfo(
    p_clientname IN VARCHAR2,
    p_shortcode IN VARCHAR2,
    p_ResultSet OUT SYS_REFCURSOR
)
AS
BEGIN
 OPEN p_ResultSet FOR
        SELECT 
            ID AS NonClientId,
            CLIENTNAME,
            SHORTCODE,
            CONTACTNAME,
            CONTACTDESIGNATION,
            MOBILENO,
            EMAILID,
            CASE 
                WHEN ORGNTYPE = 'P' THEN 'Private'
                WHEN ORGNTYPE = 'U' THEN 'PSU'
                WHEN ORGNTYPE = 'S' THEN 'State Government'
                WHEN ORGNTYPE = 'F' THEN 'Foreing Railways'
                WHEN ORGNTYPE = 'C' THEN 'Central Government'
                ELSE ORGNTYPE
            END AS ORGNTYPE
        FROM 
            Non_Rly_Client
        WHERE 
            (ISDELETED = 0 OR ISDELETED IS NULL)
            AND (UPPER(TRIM(CLIENTNAME)) LIKE UPPER(TRIM(COALESCE(p_clientname, ''))) || '%' OR p_clientname IS NULL)
            AND (UPPER(TRIM(SHORTCODE)) LIKE UPPER(TRIM(COALESCE(p_shortcode, ''))) || '%' OR p_shortcode IS NULL);
END;
/


create or replace PROCEDURE compliants_statement_reporttypes_Report (
    p_Frm_dt IN VARCHAR2,
    p_To_dt IN VARCHAR2,
    p_Co IN VARCHAR2,
    p_Ie IN VARCHAR2,
    p_Vend_cd IN VARCHAR2,
    p_Consignee_cd IN VARCHAR2,
    p_Today_dt IN VARCHAR2,
    p_Fin_year IN VARCHAR2,
    p_Bpo_rly IN VARCHAR2,
    p_Client_type IN VARCHAR2,
    p_Region IN VARCHAR2,
    p_Awaiting_ji IN VARCHAR2,
    p_Awaiting_conclusion IN VARCHAR2,
    p_Awaiting_action IN VARCHAR2,
    p_Awaiting_finalaction IN VARCHAR2,
    p_Cm_wise IN VARCHAR2,
    p_Ie_wise IN VARCHAR2,
    p_Vendor_wise IN VARCHAR2,
    p_Client_wise IN VARCHAR2,
    p_Consignee_wise IN VARCHAR2,
    p_result OUT SYS_REFCURSOR
) IS
 v_query VARCHAR2(7000) := '';
BEGIN
        IF p_Frm_dt IS NOT NULL AND p_To_dt IS NOT NULL THEN
            v_query := 'select DECODE(INSP_REGION,''N'',''NORTHERN'',''S'',''SOUTHERN'',''E'',''EASTERN'',''W'',''WESTERN'',''CENTRAL'') IN_REGION,COMPLAINT_ID,to_char(COMPLAINT_DT,''dd/mm/yyyy'')COMPLAINT_DATE,REJ_MEMO_NO||'' Dt. ''||to_char(REJ_MEMO_DT,''dd/mm/yyyy'') REJ_MEMO, CASE_NO,BK_NO||'' & ''||SET_NO BK_SET,T40.IE_NAME, IE_CO_NAME,decode(COMP_RECV_REGION,''N'',''Northern'',''S'',''Southern'',''W'',''Western'',''E'',''Eastern'',''C'',''Central'') COMP_RECV_REGION, CONSIGNEE_NAME||'', ''||CONSIGNEE_CITY CONSIGNEE, VENDOR, ITEM_DESC, QTY_OFFERED||'' ''||UOM_S_DESC QTY_OFF,QTY_REJECTED||'' ''||UOM_S_DESC QTY_REJECTED,REJECTION_VALUE, REJECTION_REASON, STATUS, DECODE(JI_REQUIRED,''Y'',''Yes'',''N'',''NO'',''Cancelled'')JI_REQUIRED, JI_SNO, to_char(JI_FIX_DT,''dd/mm/yyyy'')JI_DATE, T38.DEFECT_DESC, T39.JI_STATUS_DESC, ACTION, L5NO_PO PO_NO, to_char(PO_DT,''dd/mm/yyyy'')PO_DATE, to_char(IC_DT,''dd/mm/yyyy'')IC_DATE,T09.IE_NAME JI_IE_NAME,Decode(ACTION_PROPOSED,''W'',''Warning Letter'',''I'',''Minor Penalty'',''J'',''Major Penalty'',''O'',''Others'') ACTION_PROPOSED, to_char(ACTION_PROPOSED_DT,''dd/mm/yyyy'') ACTION_PROPOSED_DATE, CO_NAME, T40.CASE_NO, T40.BK_NO, T40.SET_NO, REMARKS, TO_CHAR(T40.CONCLUSION_DT,''DD/MM/YYYY'')CONCLUSION_DATE, DECODE(NO_JI_REASON,''A'',''DP Expired'',''B'',''Validity of IC Expired'',''C'',''Broken Condition'',''D'',''Rejection <5%'',''E'',''Rejection issued after 90 Days of reciept of material'',''F'',''Guarantee Claim'',''G'',''Wrong Dispatch'') NO_JI_RES,decode(T09.IE_DEPARTMENT,''C'',''Civil'',''E'',''Electrical'',''M'',''Mechanical'',''L'',''Metallergy'',''Others'') DEPT,ROOT_CAUSE_ANALYSIS,TECH_REF,DECODE(CHKSHEET_STATUS,''A'',''APPROVED'',''R'',''REVISION'',''P'',''PREPRATION'')CHK_STATUS,ANY_OTHER,CAPA_STATUS,DANDAR_STATUS from V40_CONSIGNEE_COMPLAINTS T40,T38_DEFECT_CODES T38,T39_JI_STATUS_CODES T39,T09_IE T09, T08_IE_CONTROLL_OFFICER T08 where T40.DEFECT_CD=T38.DEFECT_CD(+) and T40.JI_STATUS_CD =T39.JI_STATUS_CD(+) and T40.JI_IE_CD=T09.IE_CD(+) and T40.IE_CO_CD=T08.CO_CD(+) and (JI_DT between to_date('''||p_Frm_dt||''',''dd/mm/yyyy'') and to_date('''||p_To_dt||''',''dd/mm/yyyy'')) and INSP_REGION='''||p_Region||''' and JI_REQUIRED=''Y''';
        ELSIF p_Fin_year IS NOT NULL THEN
           v_query := 'select DECODE(INSP_REGION,''N'',''NORTHERN'',''S'',''SOUTHERN'',''E'',''EASTERN'',''W'',''WESTERN'',''CENTRAL'') IN_REGION,COMPLAINT_ID,to_char(COMPLAINT_DT,''dd/mm/yyyy'')COMPLAINT_DATE,REJ_MEMO_NO||'' Dt. ''||to_char(REJ_MEMO_DT,''dd/mm/yyyy'') REJ_MEMO, CASE_NO,BK_NO||'' & ''||SET_NO BK_SET,T40.IE_NAME, IE_CO_NAME,decode(COMP_RECV_REGION,''N'',''Northern'',''S'',''Southern'',''W'',''Western'',''E'',''Eastern'',''C'',''Central'') COMP_RECV_REGION, CONSIGNEE_NAME||'', ''||CONSIGNEE_CITY CONSIGNEE, VENDOR, ITEM_DESC, QTY_OFFERED||'' ''||UOM_S_DESC QTY_OFF,QTY_REJECTED||'' ''||UOM_S_DESC QTY_REJECTED,REJECTION_VALUE, REJECTION_REASON, STATUS, DECODE(JI_REQUIRED,''Y'',''Yes'',''N'',''NO'',''Cancelled'')JI_REQUIRED, JI_SNO, to_char(JI_FIX_DT,''dd/mm/yyyy'')JI_DATE, T38.DEFECT_DESC, T39.JI_STATUS_DESC, ACTION, L5NO_PO PO_NO, to_char(PO_DT,''dd/mm/yyyy'')PO_DATE, to_char(IC_DT,''dd/mm/yyyy'')IC_DATE,T09.IE_NAME JI_IE_NAME,Decode(ACTION_PROPOSED,''W'',''Warning Letter'',''I'',''Minor Penalty'',''J'',''Major Penalty'',''O'',''Others'') ACTION_PROPOSED, to_char(ACTION_PROPOSED_DT,''dd/mm/yyyy'') ACTION_PROPOSED_DATE, CO_NAME, T40.CASE_NO, T40.BK_NO, T40.SET_NO, REMARKS, TO_CHAR(T40.CONCLUSION_DT,''DD/MM/YYYY'')CONCLUSION_DATE, DECODE(NO_JI_REASON,''A'',''DP Expired'',''B'',''Validity of IC Expired'',''C'',''Broken Condition'',''D'',''Rejection <5%'',''E'',''Rejection issued after 90 Days of reciept of material'',''F'',''Guarantee Claim'',''G'',''Wrong Dispatch'') NO_JI_RES,decode(T09.IE_DEPARTMENT,''C'',''Civil'',''E'',''Electrical'',''M'',''Mechanical'',''L'',''Metallergy'',''Others'') DEPT,ROOT_CAUSE_ANALYSIS,TECH_REF,DECODE(CHKSHEET_STATUS,''A'',''APPROVED'',''R'',''REVISION'',''P'',''PREPRATION'')CHK_STATUS,ANY_OTHER,CAPA_STATUS,DANDAR_STATUS from V40_CONSIGNEE_COMPLAINTS T40,T38_DEFECT_CODES T38,T39_JI_STATUS_CODES T39,T09_IE T09, T08_IE_CONTROLL_OFFICER T08 where T40.DEFECT_CD=T38.DEFECT_CD(+) and T40.JI_STATUS_CD =T39.JI_STATUS_CD(+) and T40.JI_IE_CD=T09.IE_CD(+) and T40.IE_CO_CD=T08.CO_CD(+) and (substr(JI_SNO,4,5)=''' || p_Fin_year || ''') and INSP_REGION=''' || p_Region || ''' and JI_REQUIRED=''Y''';
        END IF;

      IF p_Awaiting_ji = 'true' THEN
             v_query := v_query || ' AND (NVL(JI_DT,''01-JAN-00'')=''01-JAN-00'' OR JI_FIX_DT>to_date('''||p_Today_dt||''',''dd/mm/yyyy'')';
      ELSIF p_Awaiting_conclusion = 'true' THEN
         v_query := v_query ||  ' and (NVL(JI_DT,''01-JAN-00'')<>''01-JAN-00'') and (NVL(CONCLUSION_DT,''01-JAN-00'')=''01-JAN-00'' OR CONCLUSION_DT>to_date('''||p_Today_dt||''',''dd/mm/yyyy''))';
      ELSIF p_Awaiting_action = 'true' THEN
         v_query := v_query || ' and (NVL(JI_DT,''01-JAN-00'')<>''01-JAN-00'') and (NVL(CONCLUSION_DT,''01-JAN-00'')<>''01-JAN-00'') AND (NVL(ACTION_PROPOSED_DT,''01-JAN-00'')=''01-JAN-00'' OR ACTION_PROPOSED_DT>to_date('''||p_Today_dt||''',''dd/mm/yyyy''))';
      ELSIF p_Awaiting_finalaction = 'true' THEN
         v_query := v_query || ' and (NVL(JI_DT,''01-JAN-00'')<>''01-JAN-00'') and (NVL(CONCLUSION_DT,''01-JAN-00'')<>''01-JAN-00'') AND (NVL(ACTION_PROPOSED_DT,''01-JAN-00'')<>''01-JAN-00'') AND (NVL(PENALTY_DT,''01-JAN-00'')=''01-JAN-00'' OR PENALTY_DT>to_date('''||p_Today_dt||''',''dd/mm/yyyy''))';
      END IF;
      
        IF p_Cm_wise = 'true' THEN

            IF p_Co IS NOT NULL THEN        
               v_query := v_query || ' and T40.IE_CO_CD=''' || p_Co || ''' order by JI_SNO,COMPLAINT_DT' ;
            ELSE
               v_query := v_query || ' order by IE_CO_NAME,JI_SNO,COMPLAINT_DT';
            END IF;

       ELSIF p_Ie_wise = 'true' THEN
            IF p_Ie IS NOT NULL THEN
             v_query := v_query || ' AND T40.IE_CD=''' || p_Ie || ''' order by JI_SNO,COMPLAINT_DT';
            ELSE
                v_query := v_query || ' order by IE_NAME,JI_SNO,COMPLAINT_DT';
            END IF;
       ELSIF p_Vendor_wise='true' THEN

             IF p_Vend_cd IS NOT NULL THEN
               v_query := v_query ||  ' and T40.VEND_CD=''' || p_Vend_cd || ''' order by JI_SNO,COMPLAINT_DT';
            ELSE
                v_query := v_query || ' order by VENDOR,JI_SNO,COMPLAINT_DT';
            END IF;

       ELSIF p_Client_wise = 'true' THEN

            IF p_Bpo_rly IS NOT NULL and p_Client_type IS NOT NULL THEN
                 v_query := v_query || ' and T40.BPO_TYPE=''' ||p_Client_type||''' and T40.RLY_CD=''' ||p_Bpo_rly|| ''' order by JI_SNO,COMPLAINT_DT';
            ELSE
                v_query := v_query || ' order by BPO_TYPE,RLY_CD,JI_SNO,COMPLAINT_DT';
            END IF;

       ELSIF p_Consignee_wise = 'true' THEN

            IF p_Consignee_cd IS NOT NULL THEN
              v_query := v_query || ' and T40.CONSIGNEE_CD=''' || p_Consignee_cd|| ''' order by JI_SNO,COMPLAINT_DT';
           ELSE
            v_query := v_query || ' order by CONSIGNEE_CD,RLY_CD,JI_SNO,COMPLAINT_DT';
           END IF;

       END IF;

 OPEN p_result FOR v_query;
END;
/


create or replace PROCEDURE Defect_Code_Wise_Report (
    p_From_date IN VARCHAR2,
    p_To_date IN VARCHAR2,
    p_Region IN VARCHAR2,
    p_result OUT SYS_REFCURSOR
) AS
BEGIN
 OPEN p_result FOR
        select DEFECT_CD,DEFECT_DESC,SUM(UPHELD) UPHELD,SUM(SORTING) SORTING,SUM(RECTIFICATION) RECTIFICATION,SUM(PRICE_REDUCTION) PRICE_REDUCTION from 
        (select T38.DEFECT_CD,T38.DEFECT_DESC,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION from T40_CONSIGNEE_COMPLAINTS T40,T38_DEFECT_CODES T38 where T40.DEFECT_CD=T38.DEFECT_CD and JI_STATUS_CD=2 and JI_REQUIRED='Y' and substr(T40.COMPLAINT_ID,1,1)=p_Region and (T40.COMPLAINT_DT BETWEEN to_date(p_From_date,'dd/mm/yyyy') AND to_date(p_To_date,'dd/mm/yyyy')) group by T38.DEFECT_CD,T38.DEFECT_DESC 
        UNION ALL select T38.DEFECT_CD,T38.DEFECT_DESC,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION from T40_CONSIGNEE_COMPLAINTS T40,T38_DEFECT_CODES T38 where T40.DEFECT_CD=T38.DEFECT_CD and JI_STATUS_CD=3 and JI_REQUIRED='Y' and substr(T40.COMPLAINT_ID,1,1)=p_Region and (T40.COMPLAINT_DT BETWEEN to_date(p_From_date,'dd/mm/yyyy') AND to_date(p_To_date,'dd/mm/yyyy')) group by T38.DEFECT_CD,T38.DEFECT_DESC 
        UNION ALL select T38.DEFECT_CD,T38.DEFECT_DESC,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION from T40_CONSIGNEE_COMPLAINTS T40,T38_DEFECT_CODES T38 where T40.DEFECT_CD=T38.DEFECT_CD and JI_STATUS_CD=4 and JI_REQUIRED='Y' and substr(T40.COMPLAINT_ID,1,1)=p_Region and (T40.COMPLAINT_DT BETWEEN to_date(p_From_date,'dd/mm/yyyy') AND to_date(p_To_date,'dd/mm/yyyy')) group by T38.DEFECT_CD,T38.DEFECT_DESC 
        UNION ALL select T38.DEFECT_CD,T38.DEFECT_DESC,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION from T40_CONSIGNEE_COMPLAINTS T40,T38_DEFECT_CODES T38 where T40.DEFECT_CD=T38.DEFECT_CD and JI_STATUS_CD=5 and JI_REQUIRED='Y' and substr(T40.COMPLAINT_ID,1,1)=p_Region and (T40.COMPLAINT_DT BETWEEN to_date(p_From_date,'dd/mm/yyyy') AND to_date(p_To_date,'dd/mm/yyyy')) group by T38.DEFECT_CD,T38.DEFECT_DESC 
        ) group by DEFECT_CD,DEFECT_DESC order by DEFECT_CD;
END;
/

create or replace PROCEDURE GetDailyIEWorkPlanReport (
    p_region    IN VARCHAR2,
    rdbIEWise   IN VARCHAR2,
    rdbCOWise   IN VARCHAR2,
    FrmDt       IN VARCHAR2,
    ToDt        IN VARCHAR2,
    lstIE       IN VARCHAR2,
    lstCO       IN VARCHAR2,
    rdopartIE   IN VARCHAR2,
    rdopartCM   IN VARCHAR2,
    p_result    OUT SYS_REFCURSOR,
    p_result1   OUT SYS_REFCURSOR
)
AS
    v_query VARCHAR2(4000) := '';
    v_query1 VARCHAR2(4000) := '';
BEGIN
    IF rdbIEWise = 'true' THEN
        v_query := 'SELECT a.CO_NAME, a.IE_NAME, to_char(a.VISIT_DT,''dd/mm/yyyy'') VISIT_DATE, ' ||
                   'to_char(a.DATETIME,''DD/MM/YYYY-HH24:MI:SS'') LOGIN_TIME, a.CASE_NO, ' ||
                   'to_char(a.CALL_RECV_DT,''dd/mm/yyyy'') CALL_RECV_DATE, a.CALL_SNO, ' ||
                   'a.MFG_NAME, a.MFG_PLACE, a.MFG_CITY, a.CALL_STATUS, ' ||
                   'TO_CHAR(a.DT_INSP_DESIRE,''dd/mm/yyyy'') DESIRE_DT, a.ITEM_DESC_PO, ' ||
                   'NVL(b.VALUE,0) VALUE, ' ||
                   'decode((SELECT COUNT(ITEM_CD) FROM T15_PO_DETAIL T15, T18_CALL_DETAILS T18 ' ||
                   'WHERE T15.CASE_NO=T18.CASE_NO AND T15.ITEM_SRNO=T18.ITEM_SRNO_PO AND ' ||
                   'T18.CASE_NO=a.CASE_NO AND CALL_RECV_DT=a.CALL_RECV_DT AND CALL_SNO=a.CALL_SNO), ' ||
                   '0,''No'',''Yes'') CHK_COUNT ' ||
                   'FROM (SELECT T08.CO_NAME, T09.IE_NAME, VISIT_DT, T47.DATETIME, T47.CASE_NO, ' ||
                   'T47.CALL_RECV_DT, T47.CALL_SNO, T05.VEND_NAME MFG_NAME, T47.MFG_PLACE, ' ||
                   'T03.CITY MFG_CITY, decode(T21.CALL_STATUS_CD,''C'', ' ||
                   'T21.CALL_STATUS_DESC||decode(T17.CALL_CANCEL_STATUS,''N'','' (Non Chargeable)'', ' ||
                   '''C'',''(Chargeable)''||''@''||T17.CALL_CANCEL_CHARGES||''+ S.T.'',''''),' ||
                   '''B'',''Accepted'',T21.CALL_STATUS_DESC)||''on''|| ' ||
                   'to_char(T17.CALL_STATUS_DT ,''dd/mm/yyyy'') CALL_STATUS, T17.DT_INSP_DESIRE, ' ||
                   'T18.ITEM_DESC_PO FROM T47_IE_WORK_PLAN T47, T08_IE_CONTROLL_OFFICER T08, ' ||
                   'T05_VENDOR T05, T09_IE T09, T03_CITY T03, T17_CALL_REGISTER T17, ' ||
                   'T21_CALL_STATUS_CODES T21, T18_CALL_DETAILS T18 ' ||
                   'WHERE T47.CO_CD=T08.CO_CD AND T47.IE_CD=T09.IE_CD AND T47.MFG_CD=T05.VEND_CD ' ||
                   'AND T05.VEND_CITY_CD=T03.CITY_CD AND T17.CALL_STATUS=T21.CALL_STATUS_CD ' ||
                   'AND T47.CASE_NO=T17.CASE_NO AND T47.CALL_RECV_DT=T17.CALL_RECV_DT ' ||
                   'AND T47.CALL_SNO=T17.CALL_SNO AND T17.CASE_NO=T18.CASE_NO ' ||
                   'AND T17.CALL_RECV_DT=T18.CALL_RECV_DT AND T17.CALL_SNO=T18.CALL_SNO';

        v_query := v_query || ' AND (TO_CHAR(T47.VISIT_DT,''yyyyMMdd'')>=''' || FrmDt || ''' AND ' ||
                             'TO_CHAR(T47.VISIT_DT,''yyyyMMdd'')<=''' || ToDt || ''') AND ' ||
                             'T47.REGION_CODE=''' || p_region || ''' AND ' ||
                             '(T18.ITEM_SRNO_PO=(SELECT MIN(B.ITEM_SRNO_PO) FROM T18_CALL_DETAILS B ' ||
                             'WHERE B.CASE_NO=T18.CASE_NO AND B.CALL_RECV_DT=T18.CALL_RECV_DT AND ' ||
                             'B.CALL_SNO=T18.CALL_SNO))';

        IF rdopartIE = 'true' THEN
            v_query := v_query || ' AND T47.IE_CD=''' || lstIE || '''';
        END IF;

        v_query := v_query || ') a, ' ||
                   '(SELECT CASE_NO, CALL_RECV_DT, CALL_SNO, ROUND(SUM(VALUE), 2) VALUE FROM ' ||
                   '(SELECT T47.CASE_NO, T47.CALL_RECV_DT, T47.CALL_SNO, ' ||
                   '(T15.VALUE/DECODE(T15.QTY, 0, 1, T15.QTY))*T18.QTY_TO_INSP VALUE ' ||
                   'FROM T18_CALL_DETAILS T18, T15_PO_DETAIL T15, T47_IE_WORK_PLAN T47 ' ||
                   'WHERE T15.CASE_NO=T18.CASE_NO AND T15.ITEM_SRNO=T18.ITEM_SRNO_PO ' ||
                   'AND T18.CASE_NO=T47.CASE_NO AND T18.CALL_RECV_DT=T47.CALL_RECV_DT ' ||
                   'AND T18.CALL_SNO=T47.CALL_SNO';

        v_query := v_query || ' AND (TO_CHAR(T47.VISIT_DT,''yyyyMMdd'')>=''' || FrmDt || ''' AND ' ||
                             'TO_CHAR(T47.VISIT_DT,''yyyyMMdd'')<=''' || ToDt || ''') AND ' ||
                             'T47.REGION_CODE=''' || p_region || '''';

        IF rdopartIE = 'true' THEN
            v_query := v_query || ' AND T47.IE_CD=''' || lstIE || '''';
        END IF;

        v_query := v_query || ') GROUP BY CASE_NO, CALL_RECV_DT, CALL_SNO) b ' ||
                             'WHERE a.CASE_NO=b.CASE_NO AND a.CALL_RECV_DT=b.CALL_RECV_DT AND ' ||
                             'a.CALL_SNO=b.CALL_SNO ORDER BY a.VISIT_DT, a.DATETIME, IE_NAME, ' ||
                             'MFG_CITY, MFG_NAME, a.CALL_RECV_DT, CALL_SNO';
    ELSIF rdbCOWise = 'true' THEN
        v_query := 'SELECT a.CO_NAME, a.IE_NAME, to_char(a.VISIT_DT,''dd/mm/yyyy'') VISIT_DATE, ' ||
                   'to_char(a.DATETIME,''DD/MM/YYYY-HH24:MI:SS'') LOGIN_TIME, a.CASE_NO, ' ||
                   'to_char(a.CALL_RECV_DT,''dd/mm/yyyy'') CALL_RECV_DATE, a.CALL_SNO, ' ||
                   'a.MFG_NAME, a.MFG_PLACE, a.MFG_CITY, a.CALL_STATUS, ' ||
                   'TO_CHAR(a.DT_INSP_DESIRE,''dd/mm/yyyy'') DESIRE_DT, a.ITEM_DESC_PO, ' ||
                   'NVL(b.VALUE,0) VALUE, ' ||
                   'decode((SELECT COUNT(ITEM_CD) FROM T15_PO_DETAIL T15, T18_CALL_DETAILS T18 ' ||
                   'WHERE T15.CASE_NO=T18.CASE_NO AND T15.ITEM_SRNO=T18.ITEM_SRNO_PO AND ' ||
                   'T18.CASE_NO=a.CASE_NO AND CALL_RECV_DT=a.CALL_RECV_DT AND CALL_SNO=a.CALL_SNO), ' ||
                   '0,''No'',''Yes'') CHK_COUNT ' ||
                   'FROM (SELECT T08.CO_NAME, T09.IE_NAME, VISIT_DT, T47.DATETIME, T47.CASE_NO, ' ||
                   'T47.CALL_RECV_DT, T47.CALL_SNO, T05.VEND_NAME MFG_NAME, T47.MFG_PLACE, ' ||
                   'T03.CITY MFG_CITY, decode(T21.CALL_STATUS_CD,''C'', ' ||
                   'T21.CALL_STATUS_DESC||decode(T17.CALL_CANCEL_STATUS,''N'','' (Non Chargeable)'', ' ||
                   '''C'',''(Chargeable)''||''@''||T17.CALL_CANCEL_CHARGES||''+ S.T.'',''''),' ||
                   '''B'',''Accepted'',T21.CALL_STATUS_DESC)||''on''|| ' ||
                   'to_char(T17.CALL_STATUS_DT ,''dd/mm/yyyy'') CALL_STATUS, T17.DT_INSP_DESIRE, ' ||
                   'T18.ITEM_DESC_PO FROM T47_IE_WORK_PLAN T47, T08_IE_CONTROLL_OFFICER T08, ' ||
                   'T05_VENDOR T05, T09_IE T09, T03_CITY T03, T17_CALL_REGISTER T17, ' ||
                   'T21_CALL_STATUS_CODES T21, T18_CALL_DETAILS T18 ' ||
                   'WHERE T47.CO_CD=T08.CO_CD AND T47.IE_CD=T09.IE_CD AND T47.MFG_CD=T05.VEND_CD ' ||
                   'AND T05.VEND_CITY_CD=T03.CITY_CD AND T17.CALL_STATUS=T21.CALL_STATUS_CD ' ||
                   'AND T47.CASE_NO=T17.CASE_NO AND T47.CALL_RECV_DT=T17.CALL_RECV_DT ' ||
                   'AND T47.CALL_SNO=T17.CALL_SNO AND T17.CASE_NO=T18.CASE_NO ' ||
                   'AND T17.CALL_RECV_DT=T18.CALL_RECV_DT AND T17.CALL_SNO=T18.CALL_SNO';

        v_query := v_query || ' AND (TO_CHAR(T47.VISIT_DT,''yyyyMMdd'')>=''' || FrmDt || ''' AND ' ||
                             'TO_CHAR(T47.VISIT_DT,''yyyyMMdd'')<=''' || ToDt || ''') AND ' ||
                             'T47.REGION_CODE=''' || p_region || ''' AND ' ||
                             '(T18.ITEM_SRNO_PO=(SELECT MIN(B.ITEM_SRNO_PO) FROM T18_CALL_DETAILS B ' ||
                             'WHERE B.CASE_NO=T18.CASE_NO AND B.CALL_RECV_DT=T18.CALL_RECV_DT AND ' ||
                             'B.CALL_SNO=T18.CALL_SNO))';

        IF rdopartCM = 'true' THEN
            v_query := v_query || ' AND T47.CO_CD=''' || lstCO || '''';
        END IF;

        v_query := v_query || ') a, ' ||
                   '(SELECT CASE_NO, CALL_RECV_DT, CALL_SNO, ROUND(SUM(VALUE), 2) VALUE FROM ' ||
                   '(SELECT T47.CASE_NO, T47.CALL_RECV_DT, T47.CALL_SNO, ' ||
                   '(T15.VALUE/DECODE(T15.QTY, 0, 1, T15.QTY))*T18.QTY_TO_INSP VALUE ' ||
                   'FROM T18_CALL_DETAILS T18, T15_PO_DETAIL T15, T47_IE_WORK_PLAN T47 ' ||
                   'WHERE T15.CASE_NO=T18.CASE_NO AND T15.ITEM_SRNO=T18.ITEM_SRNO_PO ' ||
                   'AND T18.CASE_NO=T47.CASE_NO AND T18.CALL_RECV_DT=T47.CALL_RECV_DT ' ||
                   'AND T18.CALL_SNO=T47.CALL_SNO';

        v_query := v_query || ' AND (TO_CHAR(T47.VISIT_DT,''yyyyMMdd'')>=''' || FrmDt || ''' AND ' ||
                             'TO_CHAR(T47.VISIT_DT,''yyyyMMdd'')<=''' || ToDt || ''') AND ' ||
                             'T47.REGION_CODE=''' || p_region || '''';

        IF rdopartCM = 'true' THEN
            v_query := v_query || ' AND T47.CO_CD=''' || lstCO || '''';
        END IF;

        v_query := v_query || ') GROUP BY CASE_NO, CALL_RECV_DT, CALL_SNO) b ' ||
                             'WHERE a.CASE_NO=b.CASE_NO AND a.CALL_RECV_DT=b.CALL_RECV_DT AND ' ||
                             'a.CALL_SNO=b.CALL_SNO ORDER BY a.VISIT_DT, a.DATETIME, CO_NAME, IE_NAME, ' ||
                             'MFG_CITY, MFG_NAME, a.CALL_RECV_DT, CALL_SNO';
    END IF;

     IF rdbIEWise = 'true' THEN
        v_query1 := v_query1 || 'SELECT T08.CO_NAME, T09.IE_NAME, TO_CHAR(NI_WORK_DT, ''DD/MM/YYYY'') AS WORK_DATE, TO_CHAR(T48.DATETIME, ''HH24:MI:SS'') AS LOGIN_TIME, ';
        v_query1 := v_query1 || 'DECODE(NI_WORK_CD, ''T'', ''Training'', ''L'', ''Leave'', ''O'', ''Office'', ''J'', ''JI'', ''F'', ''Firm Visit'', ''X'', ''Others''||''-''||NI_OTHER_DESC) AS NI_WORK_PLAN_CD ';
        v_query1 := v_query1 || 'FROM T48_NI_IE_WORK_PLAN T48, T08_IE_CONTROLL_OFFICER T08, T09_IE T09 ';
        v_query1 := v_query1 || 'WHERE T48.CO_CD=T08.CO_CD AND T48.IE_CD=T09.IE_CD ';

        IF rdopartIE = 'true' THEN
            v_query1 := v_query1 || 'AND T48.IE_CD IN (' || lstIE || ')';
        END IF;

        v_query1 := v_query1 || 'AND TO_CHAR(T48.NI_WORK_DT, ''YYYYMMDD'') BETWEEN ''' || FrmDt || ''' AND ''' || ToDt || ''' ';
        v_query1 := v_query1 || 'AND T48.REGION_CODE = :p_region ';
        v_query1 := v_query1 || 'ORDER BY T48.NI_WORK_DT, T48.DATETIME, T09.IE_NAME';
    ELSIF rdbCOWise = 'true' THEN
        v_query1 := v_query1 || 'SELECT T08.CO_NAME, T09.IE_NAME, TO_CHAR(NI_WORK_DT, ''DD/MM/YYYY'') AS WORK_DATE, TO_CHAR(T48.DATETIME, ''HH24:MI:SS'') AS LOGIN_TIME, ';
        v_query1 := v_query1 || 'DECODE(NI_WORK_CD, ''T'', ''Training'', ''L'', ''Leave'', ''O'', ''Office'', ''J'', ''JI'', ''F'', ''Firm Visit'', ''X'', ''Others''||''-''||NI_OTHER_DESC) AS NI_WORK_PLAN_CD ';
        v_query1 := v_query1 || 'FROM T48_NI_IE_WORK_PLAN T48, T08_IE_CONTROLL_OFFICER T08, T09_IE T09 ';
        v_query1 := v_query1 || 'WHERE T48.CO_CD=T08.CO_CD AND T48.IE_CD=T09.IE_CD ';

        IF rdopartCM = 'true' THEN
            v_query1 := v_query1 || 'AND T48.CO_CD IN (' || lstCO || ')';
        END IF;

        v_query1 := v_query1 || 'AND TO_CHAR(T48.NI_WORK_DT, ''YYYYMMDD'') BETWEEN ''' || FrmDt || ''' AND ''' || ToDt || ''' ';
        v_query1 := v_query1 || 'AND T48.REGION_CODE = :p_region ';
        v_query1 := v_query1 || 'ORDER BY T48.NI_WORK_DT, T48.DATETIME, T08.CO_NAME, T09.IE_NAME';
    END IF;
    OPEN p_result FOR v_query;
    OPEN p_result1 FOR v_query1 USING p_region;
END;
/

create or replace PROCEDURE GetDailyIEWorkPlanReporttbl2(
    p_region IN VARCHAR2,
    rdbIEWise IN VARCHAR2,
    rdbCOWise IN VARCHAR2,
    FrmDt IN VARCHAR2,
    ToDt IN VARCHAR2,
    lstIE IN VARCHAR2,
    lstCO IN VARCHAR2,
    rdopartIE IN VARCHAR2,
    rdopartCM IN VARCHAR2,
    p_result OUT SYS_REFCURSOR
    
)
AS
    v_query VARCHAR2(4000);
    
BEGIN
    v_query := '';

    IF rdbIEWise = 'true' THEN
        v_query := v_query || 'SELECT T08.CO_NAME, T09.IE_NAME, TO_CHAR(NI_WORK_DT, ''DD/MM/YYYY'') AS WORK_DATE, TO_CHAR(T48.DATETIME, ''HH24:MI:SS'') AS LOGIN_TIME, ';
        v_query := v_query || 'DECODE(NI_WORK_CD, ''T'', ''Training'', ''L'', ''Leave'', ''O'', ''Office'', ''J'', ''JI'', ''F'', ''Firm Visit'', ''X'', ''Others''||''-''||NI_OTHER_DESC) AS NI_WORK_PLAN_CD ';
        v_query := v_query || 'FROM T48_NI_IE_WORK_PLAN T48, T08_IE_CONTROLL_OFFICER T08, T09_IE T09 ';
        v_query := v_query || 'WHERE T48.CO_CD=T08.CO_CD AND T48.IE_CD=T09.IE_CD ';

        IF rdopartIE = 'true' THEN
            v_query := v_query || 'AND T48.IE_CD IN (' || lstIE || ')';
        END IF;

        v_query := v_query || 'AND TO_CHAR(T48.NI_WORK_DT, ''YYYYMMDD'') BETWEEN ''' || FrmDt || ''' AND ''' || ToDt || ''' ';
        v_query := v_query || 'AND T48.REGION_CODE = :p_region ';
        v_query := v_query || 'ORDER BY T48.NI_WORK_DT, T48.DATETIME, T09.IE_NAME';
    ELSIF rdbCOWise = 'true' THEN
        v_query := v_query || 'SELECT T08.CO_NAME, T09.IE_NAME, TO_CHAR(NI_WORK_DT, ''DD/MM/YYYY'') AS WORK_DATE, TO_CHAR(T48.DATETIME, ''HH24:MI:SS'') AS LOGIN_TIME, ';
        v_query := v_query || 'DECODE(NI_WORK_CD, ''T'', ''Training'', ''L'', ''Leave'', ''O'', ''Office'', ''J'', ''JI'', ''F'', ''Firm Visit'', ''X'', ''Others''||''-''||NI_OTHER_DESC) AS NI_WORK_PLAN_CD ';
        v_query := v_query || 'FROM T48_NI_IE_WORK_PLAN T48, T08_IE_CONTROLL_OFFICER T08, T09_IE T09 ';
        v_query := v_query || 'WHERE T48.CO_CD=T08.CO_CD AND T48.IE_CD=T09.IE_CD ';

        IF rdopartCM = 'true' THEN
            v_query := v_query || 'AND T48.CO_CD IN (' || lstCO || ')';
        END IF;

        v_query := v_query || 'AND TO_CHAR(T48.NI_WORK_DT, ''YYYYMMDD'') BETWEEN ''' || FrmDt || ''' AND ''' || ToDt || ''' ';
        v_query := v_query || 'AND T48.REGION_CODE = :p_region ';
        v_query := v_query || 'ORDER BY T48.NI_WORK_DT, T48.DATETIME, T08.CO_NAME, T09.IE_NAME';
    END IF;

    -- Execute the dynamic SQL with parameters
    OPEN p_result FOR v_query USING p_region;
    
    
END;
/

=============================================================================================================

create or replace PROCEDURE "JI_COMPLAINT_REPORT_C" (
    p_Finyear_Value IN VARCHAR2,
    p_FinYear_Text IN VARCHAR2,
    p_result OUT SYS_REFCURSOR
) AS
BEGIN
        OPEN p_result FOR
         Select * from (select decode(Region,'N','NRIO','E','ERIO','W','WRIO','S','SRIO') Region,decode(Region,'N','A','E','B','W','C','S','D','C','E')S_code,IE,sum(NO_OF_INSPECTION) NO_OF_INSPECTION,Round((sum(MATERIAL_VALUE))/100000,2) MATERIAL_VALUE,sum(RECD) RECD,sum(FINALISED) FINALISED,sum(PENDING) PENDING,sum(ACCEPTED) ACCEPTED,sum(UPHELD) UPHELD ,sum(SORTING) SORTING,sum(RECTIFICATION) RECTIFICATION,sum(PRICE_REDUCTION) PRICE_REDUCTION,sum(LIFTED_BEFORE_JI) LIFTED_BEFORE_JI,sum(TRANSIT_DEMAGE) TRANSIT_DEMAGE,sum(UNSTAMPED) UNSTAMPED,sum(NOT_ON_RITES_AC) NOT_ON_RITES_AC,sum(UPHELD+SORTING+RECTIFICATION+PRICE_REDUCTION+LIFTED_BEFORE_JI) Tot,row_number() over (partition by decode(Region,'N','NRIO','E','ERIO','W','WRIO','S','SRIO') order by sum(UPHELD+SORTING+RECTIFICATION+PRICE_REDUCTION+LIFTED_BEFORE_JI) desc) as country_rank From 
        ( Select SUBSTR(A.case_no,1,1) Region,SUBSTR(A.case_no,1,1) S_Code,B.IE_NAME IE,count(*)  NO_OF_INSPECTION,sum(nvl(C.MATERIAL_VALUE,0)) MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC FROM T20_IC A, T09_IE B, T22_BILL C  WHERE A.IE_CD=B.IE_CD AND C.BILL_NO=A.BILL_NO  AND (substr(C.BILL_NO,2,2)=p_Finyear_Value) AND SUBSTR(A.case_no,1,1) not in ('Q','C') GROUP BY SUBSTR(A.case_no,1,1),IE_NAME 
        union all Select substr(CASE_NO,1,1) Region,substr(CASE_NO,1,1) S_Code,T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,count(*) RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and (substr(V40.JI_SNO,4,5)=p_FinYear_Text) and substr(CASE_NO,1,1) not in ('Q','C')  group by substr(CASE_NO,1,1),T09.IE_NAME
        union all Select substr(CASE_NO,1,1) Region,substr(CASE_NO,1,1) S_Code,T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,count(*) FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD<>0 and (substr(V40.JI_SNO,4,5)=p_FinYear_Text) and substr(CASE_NO,1,1) not in ('Q','C')  group by substr(CASE_NO,1,1),T09.IE_NAME
        union all Select substr(CASE_NO,1,1) Region,substr(CASE_NO,1,1) S_Code,T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,count(*)  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=0 and (substr(V40.JI_SNO,4,5)=p_FinYear_Text) and substr(CASE_NO,1,1) not in ('Q','C')  group by substr(CASE_NO,1,1),T09.IE_NAME
        union all Select substr(CASE_NO,1,1) Region,substr(CASE_NO,1,1) S_Code,T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,count(*) ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=1 and (substr(V40.JI_SNO,4,5)=p_FinYear_Text) and substr(CASE_NO,1,1) not in ('Q','C') group by substr(CASE_NO,1,1),T09.IE_NAME
        union all Select substr(CASE_NO,1,1) Region,substr(CASE_NO,1,1) S_Code,T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,count(*) UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=2 and (substr(V40.JI_SNO,4,5)=p_FinYear_Text) and substr(CASE_NO,1,1) not in ('Q','C')  group by substr(CASE_NO,1,1),T09.IE_NAME
        union all Select substr(CASE_NO,1,1) Region,substr(CASE_NO,1,1) S_Code,T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,count(*) SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=3 and (substr(V40.JI_SNO,4,5)=p_FinYear_Text) and substr(CASE_NO,1,1) not in ('Q','C')  group by substr(CASE_NO,1,1),T09.IE_NAME
        union all Select substr(CASE_NO,1,1) Region,substr(CASE_NO,1,1) S_Code,T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,count(*) RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=4 and (substr(V40.JI_SNO,4,5)=p_FinYear_Text) and substr(CASE_NO,1,1) not in ('Q','C') group by substr(CASE_NO,1,1),T09.IE_NAME
        union all Select substr(CASE_NO,1,1) Region,substr(CASE_NO,1,1) S_Code,T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,count(*) PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=5 and (substr(V40.JI_SNO,4,5)=p_FinYear_Text) and substr(CASE_NO,1,1) not in ('Q','C')  group by substr(CASE_NO,1,1),T09.IE_NAME
        union all Select substr(CASE_NO,1,1) Region,substr(CASE_NO,1,1) S_Code,T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,count(*) LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=6 and (substr(V40.JI_SNO,4,5)=p_FinYear_Text) and substr(CASE_NO,1,1) not in ('Q','C')  group by substr(CASE_NO,1,1),T09.IE_NAME
        union all Select substr(CASE_NO,1,1) Region,substr(CASE_NO,1,1) S_Code,T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,count(*) TRANSIT_DEMAGE,0 UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=7 and (substr(V40.JI_SNO,4,5)=p_FinYear_Text) and substr(CASE_NO,1,1) not in ('Q','C')  group by substr(CASE_NO,1,1),T09.IE_NAME
        union all Select substr(CASE_NO,1,1) Region,substr(CASE_NO,1,1) S_Code,T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,count(*) UNSTAMPED,0 NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=8 and (substr(V40.JI_SNO,4,5)=p_FinYear_Text) and substr(CASE_NO,1,1) not in ('Q','C')  group by substr(CASE_NO,1,1),T09.IE_NAME
        union all Select substr(CASE_NO,1,1) Region,substr(CASE_NO,1,1) S_Code,T09.IE_NAME IE,0 NO_OF_INSPECTION,0 MATERIAL_VALUE,0 RECD,0 FINALISED,0  PENDING,0 ACCEPTED,0 UPHELD,0 SORTING,0 RECTIFICATION,0 PRICE_REDUCTION,0 LIFTED_BEFORE_JI,0 TRANSIT_DEMAGE,0 UNSTAMPED,count(*) NOT_ON_RITES_AC from V40_CONSIGNEE_COMPLAINTS V40, T09_IE T09 where V40.IE_CD=T09.IE_CD and JI_REQUIRED='Y' and JI_STATUS_CD=9 and (substr(V40.JI_SNO,4,5)=p_FinYear_Text) and substr(CASE_NO,1,1) not in ('Q','C')  group by substr(CASE_NO,1,1),T09.IE_NAME
        ) group by Region,IE order by S_Code,Tot Desc) WHERE country_rank<=3;

END;


=============================================================================================================

ALTER TABLE online_payment ADD CUST_EMAIL VARCHAR2(255);
ALTER TABLE online_payment ADD CUST_MOBILE VARCHAR2(20);
ALTER TABLE online_payment ADD MER_ID VARCHAR2(20);
ALTER TABLE online_payment ADD MER_TXN_DATE TIMESTAMP(6) WITH TIME ZONE;

ALTER TABLE online_payment ADD MER_TXN_ID VARCHAR2(50);
ALTER TABLE online_payment ADD ATOM_TXN_ID VARCHAR2(50);
ALTER TABLE online_payment ADD CUST_ACC_NO VARCHAR2(50);
ALTER TABLE online_payment ADD TXN_COMPLETE_DATE TIMESTAMP(6) WITH TIME ZONE;
ALTER TABLE online_payment ADD BANK_TXN_ID VARCHAR2(50);

ALTER TABLE online_payment ADD BANK_NAME VARCHAR2(100);
ALTER TABLE online_payment ADD SUB_CHANNEL VARCHAR2(20);
ALTER TABLE online_payment ADD DESCRIPTION VARCHAR2(100);
ALTER TABLE online_payment ADD STATUS_CD VARCHAR2(20);
ALTER TABLE online_payment MODIFY TRANSACTION_NO VARCHAR2(20);
--ALTER TABLE online_payment ADD Tok_ID VARCHAR2(20);

=================================================================================================
CREATE OR REPLACE PROCEDURE GetBillFinalisationForm(
    p_FromDate IN VARCHAR2,
    p_ToDate IN VARCHAR2,
    p_Sector IN VARCHAR2,
    p_Region IN VARCHAR2,
    p_page_start NUMBER,
    p_page_end NUMBER,
    p_RESULT OUT SYS_REFCURSOR,
    p_result_records OUT SYS_REFCURSOR
) AS
    total_records NUMBER;
BEGIN
    SELECT COUNT(*) INTO total_records 
    FROM
     v22_bill v22
        WHERE v22.Bill_Dt >= TO_DATE('01-11-20', 'dd-mm-yy') 
        AND v22.SENT_TO_SAP IS null 
        AND v22.BILL_FINALISED IS null 
        AND v22.REGION_CODE = p_Region
        AND (V22.BILL_DT BETWEEN TO_DATE(p_FromDate, 'dd/MM/yyyy') AND TO_DATE(p_ToDate, 'dd/MM/yyyy'))
        AND ((p_Sector != 'A' and v22.bpo_type = p_Sector) OR (p_Sector = 'A' AND 1 = 1))
        ORDER BY v22.BILL_NO;

    OPEN p_result_records FOR SELECT total_records as total_records FROM DUAL;
    
    OPEN p_RESULT FOR
    SELECT * FROM (SELECT ROWNUM AS rnum, t.* FROM (
    SELECT
        v22.bill_no AS BillNo,
        v22.bill_dt AS BillDt,
        v22.insp_fee AS InspFee,
        v22.Cgst AS Cgst,
        v22.Sgst AS Sgst,
        v22.Igst AS Igst,
        v22.bill_amount AS BillAmount,
        v22.invoice_no AS InvoiceNo,
        v22.bpo_name || '/' || v22.bpo_rly || '/' || v22.bpo_city AS BPO,
        v22.Consignee || '/' || v22.consignee_city AS Consignee,
        v22.recipient_gstin_no AS RecipientGstinNo
    FROM
         v22_bill v22
        WHERE v22.Bill_Dt >= TO_DATE('01-11-20', 'dd-mm-yy') 
        AND v22.SENT_TO_SAP IS null 
        AND v22.BILL_FINALISED IS null 
        AND v22.REGION_CODE = p_Region
        AND (V22.BILL_DT BETWEEN TO_DATE(p_FromDate, 'dd/MM/yyyy') AND TO_DATE(p_ToDate, 'dd/MM/yyyy'))
        AND ((p_Sector != 'A' and v22.bpo_type = p_Sector) OR (p_Sector = 'A' AND 1 = 1))
        ORDER BY v22.BILL_NO
            )t where ROWNUM <= p_page_end) WHERE rnum >= p_page_start;
END;

